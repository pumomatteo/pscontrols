{"version":3,"file":"maps.js","sources":["../../../../src/ui/controls/maps.ts"],"sourcesContent":["import { ControlTypeEnum, MapMarker, MapModeEnum, puma } from \"../vr\";\nimport { VrControlOptions, VrControl, VrControlsEvent } from \"../common\";\ndeclare var L: any;\n\n//#region Options\nexport class MapsOptions extends VrControlOptions\n{\n    latitude?: number;\n    longitude?: number;\n    zoom?: number;\n    maxZoom?: number;\n    credits?: boolean | string;\n    marker?: boolean | MapMarker[];\n    mode?: MapModeEnum;\n\n    onClick?: (e: MapClickEvent) => void;\n    onPinClick?: (e: MapPinClickEvent) => void;\n    onHover?: (e: MapPinHoverEvent) => void;\n}\n//#endregion\n\n//#region Control\nexport class Maps extends VrControl\n{\n    private _map: any;\n    private _internalMarkerList: any[];\n\n    constructor(element: HTMLElement, options?: MapsOptions | null)\n    {\n        //#region Options\n        if (options == null)\n            options = new MapsOptions();\n\n        if (options.zoom == null) options.zoom = 15;\n        if (options.maxZoom == null) options.maxZoom = 18;\n        if (options.marker == null) options.marker = true;\n        if (options.latitude == null) options.latitude = 0;\n        if (options.longitude == null) options.longitude = 0;\n        if (options.height == null) options.height = 200;\n        if (options.width == null) options.width = \"100%\";\n        if (options.mode == null) options.mode = MapModeEnum.Light;\n        if (options.tabIndex == null) options.tabIndex = -1;\n\n        if (options.credits == null) options.credits = true;\n        if (options.credits)\n            options.credits = `<span style='font-size: 10px'><a href='https://www.openstreetmap.org/'>OpenStreetMap</a> contributors`;\n        else\n            options.credits = \"\";\n        //#endregion\n\n        let enable = options.enable;\n        if (options.enable == false)\n            options.enable = undefined;\n\n        super(element, options, ControlTypeEnum.Map);\n\n        this._internalMarkerList = [];\n        puma(this.element()).height(\"100%\");\n\n        let accessToken = \"pk.eyJ1IjoibWF0dGV1enppc3RlZmFubyIsImEiOiJja3I3aHp2bzIwNHNpMnBtYzVndGN5YzFxIn0.tEqLhXaDn9FC9Mrqu8o-lQ\";\n        this._map = L.map(this.element(), { preferCanvas: true }).setView([options.latitude, options.longitude], options.zoom);\n        L.tileLayer(\"https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=\" + accessToken, {\n            maxZoom: options.maxZoom,\n            attribution: options.credits,\n            id: options.mode,\n            tileSize: 512,\n            zoomOffset: -1\n        }).addTo(this._map);\n\n        //#region Click\n        if (options!.onClick != null)\n        {\n            puma(this._map).on(\"click\", (e: JQuery.ClickEvent) =>\n            {\n                let clickEvent = new MapPinClickEvent();\n                clickEvent.sender = this;\n                options!.onClick!(clickEvent);\n            });\n        }\n        //#endregion\n\n        if (typeof (options.marker) == \"boolean\" && options.marker)\n        {\n            let defaultMarker = new MapMarker();\n            defaultMarker.latitude = options.latitude;\n            defaultMarker.longitude = options.longitude;\n            options.marker = [defaultMarker];\n            this.marker([defaultMarker]);\n        }\n        else if (Array.isArray(options.marker))\n            this.marker(options.marker);\n\n        if (enable === false)\n            this.disable();\n        else\n            this.enable();\n    }\n\n    //#region Methods\n    map()\n    {\n        return this._map;\n    }\n\n    locate(latitude: number, longitude: number): void\n    {\n        L.latLng(latitude, longitude).addTo(this._map);\n    }\n\n    marker(markers?: MapMarker[])\n    {\n        let options = this.getOptions();\n        if (markers != null)\n        {\n            options.marker = markers;\n            for (let marker of markers)\n            {\n                let pin = L.circleMarker([marker.latitude, marker.longitude], {\n                    color: '#3388ff'\n                });\n\n                if (marker.title != null)\n                    pin.bindPopup(marker.title)\n\n                pin.addTo(this._map);\n                this._internalMarkerList.push(pin);\n\n                //#region Pin click\n                if (options!.onPinClick != null)\n                {\n                    puma(pin).on(\"click\", (e: JQuery.ClickEvent) =>\n                    {\n\n                        let clickEvent = new MapPinClickEvent();\n                        clickEvent.sender = this;\n                        clickEvent.coordinate = { latitude: pin._latlng.lat, longitude: pin._latlng.lng };\n                        clickEvent.point = { x: pin._point.x, y: pin._point.y };\n                        clickEvent.color = pin.options.color;\n                        clickEvent.dataItem = marker;\n                        clickEvent.element = pin;\n                        options!.onPinClick!(clickEvent);\n                    });\n                }\n                //#endregion\n\n                //#region Tooltip\n                puma(pin).on(\"mouseover\", (e: JQuery.MouseOverEvent) =>\n                {\n                    // Show tooltip/title\n                    if (marker.title != null)\n                        e.target.openPopup();\n\n                    if (options!.onHover != null)\n                    {\n                        let clickEvent = new MapPinHoverEvent();\n                        clickEvent.sender = this;\n                        clickEvent.coordinate = { latitude: pin._latlng.lat, longitude: pin._latlng.lng };\n                        clickEvent.point = { x: pin._point.x, y: pin._point.y };\n                        clickEvent.color = pin.options.color;\n                        clickEvent.dataItem = marker;\n                        clickEvent.element = pin;\n                        options!.onHover(clickEvent);\n                    }\n                })\n                //#endregion\n            }\n        }\n        return options.marker as MapMarker[];\n    }\n\n    clear()\n    {\n        let options = this.getOptions();\n        if (options.marker != null && Array.isArray(options.marker))\n        {\n            for (let marker of this._internalMarkerList)\n                this._map.removeLayer(marker);\n        }\n        this._internalMarkerList = [];\n    }\n\n    disable()\n    {\n        super.disable();\n\n        this._map.dragging.disable();\n        this._map.touchZoom.disable();\n        this._map.doubleClickZoom.disable();\n        this._map.scrollWheelZoom.disable();\n        this._map.boxZoom.disable();\n        this._map.keyboard.disable();\n        puma(this.container()).find(\".leaflet-control-zoom\").hide();\n\n        if (this._map.tap)\n            this._map.tap.disable();\n\n        this.element().style.cursor = \"default\";\n    }\n\n    enable()\n    {\n        super.enable();\n\n        this._map.dragging.enable();\n        this._map.touchZoom.enable();\n        this._map.doubleClickZoom.enable();\n        this._map.scrollWheelZoom.enable();\n        this._map.boxZoom.enable();\n        this._map.keyboard.enable();\n        puma(this.container()).find(\".leaflet-control-zoom\").show();\n\n        if (this._map.tap)\n            this._map.tap.enable();\n\n        this.element().style.cursor = \"grab\";\n    }\n\n    invalidateSize()\n    {\n        this._map.invalidateSize();\n    }\n\n    getOptions()\n    {\n        return this.options<MapsOptions>();\n    }\n    //#endregion    \n}\n//#endregion\n\n//#region Classes\nclass MapEvent extends VrControlsEvent\n{\n    sender: Maps;\n    coordinate: MapCoordinate;\n    point: MapPoint;\n    color: string;\n    dataItem: any;\n    element: any;\n}\n\nclass MapPinClickEvent extends MapEvent\n{\n}\n\nclass MapPinHoverEvent extends MapEvent\n{\n}\n\nclass MapClickEvent extends VrControlsEvent\n{\n    sender: Maps;\n}\n\nclass MapCoordinate\n{\n    latitude: number;\n    longitude: number;\n}\n\nclass MapPoint\n{\n    x: number;\n    y: number;\n}\n//#endregion"],"names":[],"mappings":"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"}