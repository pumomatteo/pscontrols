{"version":3,"file":"image.js","sources":["../../../../src/ui/controls/image.ts"],"sourcesContent":["import { ControlTypeEnum, ImagePositionTypeEnum, ImageToolbarTypeEnum, confirm, IconClass, puma } from \"../vr\";\nimport { VrControl, VrControlOptions } from \"../common\";\n\n//#region Options\nexport class ImageOptions extends VrControlOptions\n{\n    value?: string;\n    base64?: boolean;\n    tooltip?: string;\n    position?: ImagePositionTypeEnum;\n    toolbarItems?: ImageToolbarItem[];\n    overlayDescription?: boolean | string;\n\n    onHover?(): void;\n    onLeave?(): void;\n    onClick?(e: ImageClickEvent): void;\n}\n//#endregion\n\n//#region Control\nexport class Image extends VrControl\n{\n    constructor(element: HTMLElement, options?: ImageOptions | null)\n    {\n        //#region Options\n        if (options == null)\n            options = new ImageOptions();\n\n        if (options.position == null) options.position = ImagePositionTypeEnum.Original;\n        if (options.base64 == null) options.base64 = false;\n        if (options.overlayDescription == null) options.overlayDescription = false;\n        if (options.tabIndex == null) options.tabIndex = -1;\n        //#endregion\n\n        super(element, options, ControlTypeEnum.Image);\n        this.element().style.cssText += \"width: auto; height: auto;\";\n\n        //#region Value\n        if (options.value != null)\n            this.value(options.value);\n        //#endregion\n\n        //#region Tooltip\n        if (options.tooltip != null)\n        {\n            (this.element() as HTMLImageElement).alt = options.tooltip;\n            (this.element() as HTMLImageElement).title = options.tooltip;\n        }\n        //#endregion\n\n        //#region Image position\n        switch (options.position)\n        {\n            case ImagePositionTypeEnum.Center:\n                {\n                    this.container().style.cssText += \"text-align: center; justify-content: center;\";\n                    this.element().style.cssText += \"max-width: 100%; max-height: 100%;\";\n                }\n                break;\n            case ImagePositionTypeEnum.Fill: this.element().style.cssText += \"width: 100%; max-height: 100%;\"; break;\n            case ImagePositionTypeEnum.Fit: this.element().style.cssText += \"height: 100%; max-width: 100%;\"; break;\n            case ImagePositionTypeEnum.Stretch: this.element().style.cssText += \"width: 100%; height: 100%;\"; break;\n            case ImagePositionTypeEnum.Original: this.element().style.cssText += \"max-width: 100%; max-height: 100%;\"; break;\n        }\n        //#endregion\n\n        //#region Toolbar items\n        if (options.toolbarItems != null)\n        {\n            let toolbar = document.createElement(\"div\");\n            puma(toolbar).addClass(\"vrImageToolbar\");\n            puma(this.container()).prepend(toolbar);\n\n            for (let toolbarItem of options.toolbarItems)\n            {\n                if (toolbarItem.type == null) toolbarItem.type = ImageToolbarTypeEnum.Custom;\n                switch (toolbarItem.type)\n                {\n                    case ImageToolbarTypeEnum.Download:\n                        {\n                            //#region Download\n                            let downloadButton = document.createElement(\"a\");\n                            puma(downloadButton).addClass(\"vrImageDownloadToolbar vrImageToolbarItem\");\n                            downloadButton.download = \"download\";\n                            downloadButton.href = this.value();\n                            downloadButton.innerHTML = \"<i class='fa fa-download' aria-hidden='true'></i>\";\n                            toolbar.append(downloadButton);\n\n                            puma(downloadButton).click((e: JQueryEventObject) =>\n                            {\n                                if (toolbarItem.onClick != null)\n                                {\n                                    let event = new ImageToolbarClickEvent();\n                                    event.sender = this;\n                                    toolbarItem.onClick(event);\n                                }\n                            });\n                            //#endregion\n                        }\n                        break;\n                    case ImageToolbarTypeEnum.Delete:\n                        {\n                            //#region Delete\n                            let deleteButton = document.createElement(\"a\");\n                            puma(deleteButton).addClass(\"vrImageDeleteToolbar vrImageToolbarItem\");\n                            deleteButton.id = \"deleteToolbarImage_\" + element.id;\n                            deleteButton.innerHTML = \"<i class='fa fa-remove' aria-hidden='true'></i>\";\n                            toolbar.append(deleteButton);\n\n                            puma(deleteButton).click((e: JQueryEventObject) =>\n                            {\n                                if (toolbarItem.confirmationMessage != null && toolbarItem.confirmationMessage != \"\")\n                                {\n                                    confirm(toolbarItem.confirmationMessage).then(() =>\n                                    {\n                                        this.clear();\n                                        if (toolbarItem.onClick != null)\n                                        {\n                                            let event = new ImageToolbarClickEvent();\n                                            event.sender = this;\n                                            toolbarItem.onClick(event);\n                                        }\n                                    });\n                                }\n                                else\n                                {\n                                    this.clear();\n                                    if (toolbarItem.onClick != null)\n                                    {\n                                        let event = new ImageToolbarClickEvent();\n                                        event.sender = this;\n                                        toolbarItem.onClick(event);\n                                    }\n                                }\n                            });\n                            //#endregion\n                        }\n                        break;\n                    case ImageToolbarTypeEnum.Custom:\n                        {\n                            //#region Custom\n                            let customButton = document.createElement(\"a\");\n                            puma(customButton).addClass(\"vrImageToolbarItem\");\n                            customButton.innerHTML = \"<i class='fa fa-\" + toolbarItem.icon + \"'></i>\";\n                            customButton.style.cssText += \"float: right; margin-right: 7px; color: #FFF; cursor: pointer;\";\n                            toolbar.append(customButton);\n\n                            puma(customButton).click((e: JQueryEventObject) =>\n                            {\n                                if (toolbarItem.confirmationMessage != null && toolbarItem.confirmationMessage != \"\")\n                                {\n                                    confirm(toolbarItem.confirmationMessage).then(() =>\n                                    {\n                                        if (toolbarItem.onClick != null)\n                                        {\n                                            let event = new ImageToolbarClickEvent();\n                                            event.sender = this;\n                                            toolbarItem.onClick(event);\n                                        }\n                                    });\n                                }\n                                else\n                                {\n                                    if (toolbarItem.onClick != null)\n                                    {\n                                        let event = new ImageToolbarClickEvent();\n                                        event.sender = this;\n                                        toolbarItem.onClick(event);\n                                    }\n                                }\n                            });\n                            //#endregion\n                        }\n                        break;\n                }\n            }\n        }\n        //#endregion\n\n        //#region Overlay description\n        if (options.overlayDescription !== false)\n        {\n            if (options.overlayDescription == true) options.overlayDescription = \"\";\n\n            let overlayDescription = document.createElement(\"div\");\n            puma(overlayDescription).addClass(\"vrImageOverlayDescription\");\n            overlayDescription.innerHTML = options.overlayDescription;\n            puma(this.container()).prepend(overlayDescription);\n        }\n        //#endregion\n\n        //#region Events\n        puma(this.container()).on(\"mouseenter\", (e: JQuery.Event) =>\n        {\n            if (!this.enabled())\n                return;\n\n            if (this.value() != null && this.value() != \"\")\n            {\n                if (options!.toolbarItems != null)\n                    puma(this.container()).find(\".vrImageToolbar\").show();\n\n                if (options!.overlayDescription !== false)\n                    puma(this.container()).find(\".vrImageOverlayDescription\").show();\n            }\n\n            if (options!.onHover != null)\n                options!.onHover();\n        });\n\n        puma(this.container()).on(\"mouseleave\", (e: JQuery.MouseLeaveEvent) =>\n        {\n            if (!this.enabled())\n                return;\n\n            if (options!.toolbarItems != null)\n                puma(this.container()).find(\".vrImageToolbar\").hide();\n\n            if (options!.overlayDescription !== false)\n                puma(this.container()).find(\".vrImageOverlayDescription\").hide();\n\n            if (options!.onLeave != null)\n                options!.onLeave();\n        });\n\n        if (options.onClick != null)\n        {\n            this.element().style.cssText += \"cursor: pointer;\";\n            puma(this.container()).on(\"click\", (e: JQuery.ClickEvent) =>\n            {\n                if (!this.enabled())\n                    return;\n\n                let imageClickEvent = new ImageClickEvent();\n                imageClickEvent.sender = this;\n                options!.onClick!(imageClickEvent);\n            });\n        }\n        //#endregion\n    }\n\n    //#region Methods\n    value(pathOrBytes?: string, fileName?: string, mimeType?: string): string\n    {\n        let options = this.options<ImageOptions>();\n        if (pathOrBytes != null && pathOrBytes != \"\")\n        {\n            mimeType = (mimeType == null) ? \"image/png\" : mimeType;\n            fileName = (fileName == null) ? \"download\" : fileName;\n            pathOrBytes = pathOrBytes.replace(/^data:image\\/[^;]+;base64,/, '');\n\n            let prePath = (options.base64) ? \"data:\" + mimeType + \";base64,\" : \"\";\n            puma(this.element()).attr(\"src\", prePath + pathOrBytes);\n\n            //#region Download\n            if (options.base64)\n                pathOrBytes = pathOrBytes.replace(/^data:image\\/[^;]+/, 'data:application/octet-stream');\n\n            puma(this.container()).find(\".vrImageDownloadToolbar\").attr(\"href\", prePath + pathOrBytes);\n            puma(this.container()).find(\".vrImageDownloadToolbar\").attr(\"download\", fileName);\n            //#endregion \n        }\n        return puma(this.element()).attr(\"src\");\n    }\n\n    overlayDescription(description?: string): string\n    {\n        if (description != null)\n        {\n            let options = this.options<ImageOptions>();\n            if (options.overlayDescription !== false)\n                puma(this.container()).find(\".vrImageOverlayDescription\").html(description);\n        }\n        return puma(this.container()).find(\".vrImageOverlayDescription\").html();\n    }\n\n    toolbar()\n    {\n        return puma(this.container()).find(\".vrImageToolbar\")[0];\n    }\n\n    clear(): void\n    {\n        puma(this.element()).removeAttr(\"src\");\n    }\n    //#endregion\n\n    //#region Overrides\n    enable()\n    {\n        super.enable();\n        window.setTimeout(() => puma(this.toolbar()).show());\n    }\n\n    disable()\n    {\n        super.disable();\n        window.setTimeout(() => puma(this.toolbar()).hide());\n    }\n    //#endregion\n\n    getOptions()\n    {\n        return this.options<ImageOptions>();\n    }\n    //#endregion\n}\n//#endregion\n\n//#region Classes\nclass ImageToolbarItem\n{\n    type?: ImageToolbarTypeEnum;\n    icon?: IconClass;\n    confirmationMessage?: string;\n    onClick?(e: ImageToolbarClickEvent): void;\n}\n\nclass ImageToolbarClickEvent\n{\n    sender: Image;\n}\n\nclass ImageClickEvent\n{\n    sender: Image;\n}\n//#endregion"],"names":[],"mappings":"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"}