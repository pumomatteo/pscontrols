{"version":3,"file":"scheduler.js","sources":["../../../../src/ui/controls/scheduler.ts"],"sourcesContent":["import { UtilityManager } from \"../../../src/managers/utilityManager\";\nimport { VrControl, VrControlOptions, VrControlsEvent } from \"../common\";\nimport { confirm, ButtonGroupItem, ComboBoxTypeEnum, ControlTypeEnum, createButton, createButtonGroup, createComboBox, createDatePicker, DateFormatEnum, DayOfWeekEnum, div, IconClassicLight, IconClass, NotifierTypeEnum, notify, puma, SchedulerData, SchedulerNavigateActionEnum, SchedulerResource, SchedulerSlotElement, SchedulerView, SchedulerViewEnum, createSwitch, showLoader, hideLoader, SchedulerSaturationInfo, SchedulerSaturationDay, SchedulerSaturationWeekByResource, SchedulerSaturationFourWeeks, SaturationResource } from \"../vr\";\nimport { Button } from \"./button\";\nimport { ButtonGroup } from \"./buttonGroup\";\nimport { ComboBox } from \"./comboBox\";\nimport { DatePicker } from \"./datePicker\";\nimport { Switch } from \"./switch\";\n\ndeclare var html2canvas: any;\ndeclare var jsPDF: any;\n\n//#region Options\nexport class SchedulerOptions extends VrControlOptions\n{\n\tdate?: Date;\n\tstartTime?: Date;\n\tendTime?: Date;\n\ttimeslotIntervalDuration?: number;\n\tnumberOfWorkDays?: number;\n\tresources?: SchedulerResource[];\n\tfirstDayOfWeek?: DayOfWeekEnum;\n\tviews?: SchedulerView[];\n\tdaysOfWeekNames?: string[];\n\texportPdf?: boolean;\n\tmaxResourcesNumber?: SchedulerMaxResourceNumber;\n\tavailabilities?: SchedulerData[];\n\tdatasource?: SchedulerData[];\n\tsaturation?: SchedulerSaturationInfo;\n\teditable?: SchedulerEditable;\n\ttimeColumn?: boolean;\n\tshowHeader?: boolean;\n\tshowToolbar?: boolean;\n\n\tonNavigate?: (e: SchedulerNavigateEvent) => void;\n\tonViewChange?: (e: SchedulerViewChangeEvent) => void;\n\tonIntervalChange?: (e: SchedulerIntervalChangeEvent) => void;\n\tonResourcesChange?: (e: SchedulerResourcesChangeEvent) => void;\n\tonTimeslotClick?: (e: SchedulerTimeslotClickEvent) => void;\n\tonAvailabilityClick?: (e: SchedulerAvailabilityClickEvent) => void;\n\tonAppointmentClick?: (e: SchedulerAppointmentClickEvent) => void;\n\tonMoveStart?: (e: SchedulerMoveStartEvent) => void;\n\tonMoving?: (e: SchedulerMovingEvent) => void;\n\tonMoveEnd?: (e: SchedulerMoveEndEvent) => void;\n\tonExpand?: (e: SchedulerExpandEvent) => void;\n\tonCollapse?: (e: SchedulerCollapseEvent) => void;\n\tonResizeStart?: (e: SchedulerResizeStartEvent) => void;\n\tonResizing?: (e: SchedulerResizingEvent) => void;\n\tonResizeEnd?: (e: SchedulerResizeEndEvent) => void;\n}\n//#endregion\n\n//#region Control\nexport class Scheduler extends VrControl\n{\n\tprivate _dtpSchedulerDate: DatePicker;\n\tprivate _swtGroupByDateResource: Switch;\n\tprivate _btgMenuView: ButtonGroup;\n\tprivate _btnExpand: Button;\n\tprivate _btnCollapse: Button;\n\tprivate _cmbInterval: ComboBox;\n\n\tprivate _actualView: SchedulerViewEnum;\n\tprivate _actualNavigateAction: SchedulerNavigateActionEnum | null;\n\tprivate _isMoving: boolean;\n\tprivate _isResizing: boolean;\n\tprivate _timeColumnWidth: number;\n\tprivate _saturationData?: SchedulerSaturationInfo;\n\tprivate _saturationVisible: boolean;\n\n\tprivate _datasource: any[];\n\tprivate _slotElementList: SchedulerSlotElement[];\n\tprivate _availabilities: SchedulerData[];\n\n\tconstructor(element: HTMLElement, options?: SchedulerOptions | null)\n\t{\n\t\t//#region Options\n\t\tif (options == null)\n\t\t\toptions = new SchedulerOptions();\n\n\t\tif (options.startTime == null) options.startTime = new Date(new Date().getFullYear(), new Date().getMonth(), new Date().getDate(), 8, 0);\n\t\tif (options.endTime == null) options.endTime = new Date(new Date().getFullYear(), new Date().getMonth(), new Date().getDate(), 19, 0);\n\t\tif (options.maxResourcesNumber == null) options.maxResourcesNumber = new SchedulerMaxResourceNumber();\n\t\tif (options.views == null) options.views = [{ type: SchedulerViewEnum.Day, selected: true }];\n\t\tif (options.timeslotIntervalDuration == null) options.timeslotIntervalDuration = 30;\n\t\tif (options.firstDayOfWeek == null) options.firstDayOfWeek = DayOfWeekEnum.Monday;\n\t\tif (options.daysOfWeekNames == null) options.daysOfWeekNames = [\"DOM\", \"LUN\", \"MAR\", \"MER\", \"GIO\", \"VEN\", \"SAB\"];\n\t\tif (options.numberOfWorkDays == null) options.numberOfWorkDays = 6;\n\t\tif (options.exportPdf == null) options.exportPdf = true;\n\t\tif (options.date == null) options.date = new Date();\n\t\tif (options.timeColumn == null) options.timeColumn = true;\n\t\tif (options.showHeader == null) options.showHeader = true;\n\t\tif (options.showToolbar == null) options.showToolbar = true;\n\t\tif (options.editable == null) options.editable = new SchedulerEditable();\n\t\tif (options.editable.move == null) options.editable.move = true;\n\t\tif (options.editable.resize == null) options.editable.resize = true;\n\t\t//#endregion\n\n\t\toptions.width = \"100%\";\n\t\tsuper(element, options, ControlTypeEnum.Scheduler);\n\n\t\tpuma(this.container()).css({ \"flex-direction\": \"column\" });\n\t\tthis._timeColumnWidth = (options.timeColumn) ? 63 : 0; // 63 = time column width + border\n\t\tthis._saturationData = undefined;\n\n\t\tif (options.resources == null)\n\t\t\toptions.resources = [{ value: \"\", text: \"\" }];\n\n\t\t//#region View\n\t\tlet viewSelected = options.views!.filter(k => k.selected === true)[0];\n\t\tif (viewSelected == null)\n\t\t\tviewSelected = { type: SchedulerViewEnum.Day, selected: true };\n\n\t\tthis._actualView = viewSelected.type;\n\t\t//#endregion\n\n\t\t//#region Structure\n\t\tthis.drawToolbar();\n\t\tthis.drawScheduler();\n\t\tthis.manageSchedulerClick();\n\t\t//#endregion\n\n\t\t//#region Datasource/Availabilities\n\t\tif (options.datasource != null)\n\t\t\tthis.datasource(options.datasource);\n\n\t\tif (options.availabilities != null)\n\t\t\tthis.availabilities(options.availabilities);\n\t\t//#endregion\n\n\t\t//#region Saturation\n\t\tif (options.saturation != null)\n\t\t\tthis.saturation(options.saturation);\n\t\t//#endregion\n\n\t\tpuma(window).resize(() =>\n\t\t{\n\t\t\tthis.drawScheduler();\n\t\t\tthis.rebind();\n\n\t\t\tif (this._saturationData != null)\n\t\t\t\tthis.saturation(this._saturationData);\n\t\t});\n\t}\n\n\t//#region Methods\n\n\t//#region Draw \n\tdrawToolbar()\n\t{\n\t\tlet options = this.getOptions();\n\t\tlet divToolbar = div(this.container(), { class: \"vrSchedulerDivToolbar\" }, true);\n\n\t\tif (!options.showToolbar)\n\t\t\tdivToolbar.style.cssText += \"display: none;\";\n\n\t\tlet timeout = 0;\n\t\tcreateButton({\n\t\t\ticon: IconClassicLight.CaretLeft,\n\t\t\twidth: 30,\n\t\t\tonClick: (e) =>\n\t\t\t{\n\t\t\t\tlet date = this.date()!.vrAddDays((this.view() == SchedulerViewEnum.Day) ? -1 : -7);\n\t\t\t\tthis._dtpSchedulerDate.value(date, false);\n\n\t\t\t\tclearTimeout(timeout);\n\t\t\t\ttimeout = window.setTimeout(() =>\n\t\t\t\t{\n\t\t\t\t\tthis._actualNavigateAction = SchedulerNavigateActionEnum.PrevDate;\n\t\t\t\t\tthis.date(date);\n\t\t\t\t});\n\t\t\t}\n\t\t}, divToolbar);\n\n\t\tcreateButton({\n\t\t\ticon: IconClassicLight.CaretRight,\n\t\t\twidth: 30,\n\t\t\tcssContainer: \"margin-left: 5px;\",\n\t\t\tonClick: (e) =>\n\t\t\t{\n\t\t\t\tlet date = this.date()!.vrAddDays((this.view() == SchedulerViewEnum.Day) ? 1 : 7);\n\t\t\t\tthis._dtpSchedulerDate.value(date, false);\n\n\t\t\t\tclearTimeout(timeout);\n\t\t\t\ttimeout = window.setTimeout(() =>\n\t\t\t\t{\n\t\t\t\t\tthis._actualNavigateAction = SchedulerNavigateActionEnum.NextDate;\n\t\t\t\t\tthis.date(date);\n\t\t\t\t});\n\t\t\t}\n\t\t}, divToolbar);\n\n\t\tcreateButton({\n\t\t\ttext: \"Oggi\",\n\t\t\tcssContainer: \"margin-left: 5px;\",\n\t\t\tonClick: (e) =>\n\t\t\t{\n\t\t\t\tthis._actualNavigateAction = SchedulerNavigateActionEnum.Today;\n\t\t\t\tlet today = new Date();\n\t\t\t\ttoday.setHours(0, 0, 0);\n\t\t\t\tthis.date(today);\n\t\t\t}\n\t\t}, divToolbar);\n\n\t\tthis._dtpSchedulerDate = createDatePicker({\n\t\t\tformat: DateFormatEnum.LongDate,\n\t\t\tvalue: options.date,\n\t\t\twidth: 300,\n\t\t\tcssContainer: \"margin-left: 5px;\",\n\t\t\tonBeforeChange: (e) =>\n\t\t\t{\n\t\t\t\tif (e.value == null)\n\t\t\t\t\te.preventDefault();\n\t\t\t},\n\t\t\tonAfterChange: (e) => \n\t\t\t{\n\t\t\t\tthis._actualNavigateAction = SchedulerNavigateActionEnum.ChangeDate;\n\t\t\t\tthis.date(this._dtpSchedulerDate.value()!);\n\t\t\t}\n\t\t}, divToolbar);\n\n\t\tthis._swtGroupByDateResource = createSwitch({\n\t\t\tlabelSettings: { colorSettings: { textColor: \"#000\" } },\n\t\t\tlabelOff: \"Risorsa\",\n\t\t\tlabelOn: \"Data\",\n\t\t\tcssContainer: \"border-left: solid 1px #000; margin-left: 10px; padding-left: 10px; flex-direction: row; height: 24px;\",\n\t\t\tclassContainer: \"vrSchedulerSwitchGroupByDateResource\",\n\t\t\tvisible: this.view() == SchedulerViewEnum.Week,\n\t\t\tonChange: (e) => window.setTimeout(() => this.groupWeekByDate(e.checked), 50)\n\t\t}, divToolbar);\n\n\t\tthis._btnExpand = createButton({\n\t\t\ticon: IconClassicLight.Expand,\n\t\t\tcssContainer: \"float: right; margin-left: 5px;\",\n\t\t\tonClick: (e) => \n\t\t\t{\n\t\t\t\tif (options.onExpand != null)\n\t\t\t\t{\n\t\t\t\t\tlet expandEvent = new SchedulerExpandEvent();\n\t\t\t\t\texpandEvent.sender = this;\n\t\t\t\t\texpandEvent.buttonExpand = this._btnExpand;\n\t\t\t\t\texpandEvent.buttonCollpase = this._btnCollapse;\n\t\t\t\t\toptions.onExpand(expandEvent);\n\n\t\t\t\t\tif (expandEvent.isDefaultPrevented())\n\t\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tUtilityManager.enterFullScreen(this.container(), () => notify(\"ModalitÃ  fullScreen non supportata\", { type: NotifierTypeEnum.Error }));\n\t\t\t\tthis._btnCollapse.show();\n\t\t\t\tthis._btnExpand.hide();\n\t\t\t\twindow.setTimeout(() => this.adaptHeight(), 100);\n\t\t\t}\n\t\t}, divToolbar);\n\n\t\tthis._btnCollapse = createButton({\n\t\t\ticon: IconClassicLight.Collapse,\n\t\t\tcssContainer: \"float: right; margin-left: 5px;\",\n\t\t\tvisible: false,\n\t\t\tonClick: (e) => \n\t\t\t{\n\t\t\t\tif (options.onCollapse != null)\n\t\t\t\t{\n\t\t\t\t\tlet collapseEvent = new SchedulerCollapseEvent();\n\t\t\t\t\tcollapseEvent.sender = this;\n\t\t\t\t\tcollapseEvent.buttonExpand = this._btnExpand;\n\t\t\t\t\tcollapseEvent.buttonCollpase = this._btnCollapse;\n\t\t\t\t\toptions.onCollapse(collapseEvent);\n\n\t\t\t\t\tif (collapseEvent.isDefaultPrevented())\n\t\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tUtilityManager.exitFullScreen();\n\t\t\t\tthis._btnCollapse.hide();\n\t\t\t\tthis._btnExpand.show();\n\t\t\t\twindow.setTimeout(() => this.adaptHeight(), 100);\n\t\t\t}\n\t\t}, divToolbar);\n\n\t\tlet viewItems: ButtonGroupItem[] = [];\n\t\tlet viewTypes = options.views!.map(k => k.type);\n\t\tif (viewTypes.includes(SchedulerViewEnum.Day))\n\t\t\tviewItems.push({ text: \"Giorno\", value: SchedulerViewEnum.Day, selected: (this.view() == SchedulerViewEnum.Day) });\n\t\tif (viewTypes.includes(SchedulerViewEnum.Week))\n\t\t\tviewItems.push({ text: \"Settimana\", value: SchedulerViewEnum.Week, selected: (this.view() == SchedulerViewEnum.Week) });\n\t\tif (viewTypes.includes(SchedulerViewEnum.FourWeeks))\n\t\t\tviewItems.push({ text: \"Mese\", value: SchedulerViewEnum.FourWeeks, selected: (this.view() == SchedulerViewEnum.FourWeeks) });\n\n\t\tthis._btgMenuView = createButtonGroup({\n\t\t\titems: viewItems,\n\t\t\tcssContainer: \"float: right;\",\n\t\t\twidth: \"auto\",\n\t\t\tonSelect: (e) => \n\t\t\t{\n\t\t\t\tlet maxResourceNumberBasedOnView: number | null | undefined = null;\n\t\t\t\tswitch (Number(e.value))\n\t\t\t\t{\n\t\t\t\t\tcase SchedulerViewEnum.Day: maxResourceNumberBasedOnView = options.maxResourcesNumber!.dayView; break;\n\t\t\t\t\tcase SchedulerViewEnum.Week: maxResourceNumberBasedOnView = options.maxResourcesNumber!.weekView; break;\n\t\t\t\t\tcase SchedulerViewEnum.FourWeeks: maxResourceNumberBasedOnView = options.maxResourcesNumber!.fourWeeksView; break;\n\t\t\t\t}\n\n\t\t\t\tif (maxResourceNumberBasedOnView != null && this.resources().length > maxResourceNumberBasedOnView)\n\t\t\t\t{\n\t\t\t\t\tconfirm(\"Verranno visualizzate un numero di risorse maggiore<br /> del limite massimo impostato (\" + maxResourceNumberBasedOnView + \").<br /> Continuare comunque?\")\n\t\t\t\t\t\t.then(() => this.view(Number(e.value!)),\n\t\t\t\t\t\t\t() => e.sender.select([this.view()], false)); // If not\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tthis.view(Number(e.value!));\n\n\t\t\t}\n\t\t}, divToolbar);\n\t}\n\n\tprivate drawScheduler()\n\t{\n\t\tthis.drawHeader();\n\t\tthis.drawContent();\n\n\t\tif (this._saturationData != null)\n\t\t\tthis.saturation(this._saturationData);\n\n\t\tlet divContent = puma(this.getDivContent());\n\t\tif (divContent.vrHasScrollBar())\n\t\t\tpuma(this.container()).find(\".vrSchedulerDivHeader\").find(\"table\").css({ \"width\": \"Calc(100% - 17px)\" });\n\t\telse\n\t\t\tpuma(this.container()).find(\".vrSchedulerDivHeader\").find(\"table\").css({ \"width\": \"100%\" });\n\n\t\tif (this.view() == SchedulerViewEnum.Week)\n\t\t\tthis._swtGroupByDateResource.show();\n\t}\n\n\tprivate drawHeader()\n\t{\n\t\tlet options = this.getOptions();\n\t\tlet divHeader = puma(this.container()).find(\".vrSchedulerDivHeader\")[0];\n\t\tif (divHeader == null)\n\t\t\tdivHeader = div(this.element(), { class: \"vrSchedulerDivHeader\" });\n\n\t\tif (!options.showHeader)\n\t\t\tdivHeader.style.cssText += \"display: none;\";\n\n\t\tpuma(divHeader).empty();\n\t\tlet contentFragment = document.createDocumentFragment();\n\n\t\tlet table = document.createElement(\"table\");\n\t\ttable.style.cssText += \"width: 100%; table-layout: fixed; border-spacing: 0;\";\n\t\tcontentFragment.appendChild(table);\n\n\t\tswitch (this.view())\n\t\t{\n\t\t\tcase SchedulerViewEnum.Day:\n\t\t\t\t{\n\t\t\t\t\t//#region Day\n\t\t\t\t\tlet rowHeader = document.createElement(\"tr\");\n\t\t\t\t\ttable.appendChild(rowHeader);\n\n\t\t\t\t\tlet thInterval = document.createElement(\"th\");\n\t\t\t\t\tthInterval.className = \"vrSchedulerThInterval\";\n\t\t\t\t\trowHeader.appendChild(thInterval);\n\t\t\t\t\tthis.createIntervalCombo(thInterval);\n\n\t\t\t\t\tfor (let resource of this.resources())\n\t\t\t\t\t{\n\t\t\t\t\t\tlet resourceText = (resource.text != null) ? resource.text : \"\";\n\n\t\t\t\t\t\tlet th = document.createElement(\"th\");\n\t\t\t\t\t\tth.title = resourceText.toUpperCase();\n\t\t\t\t\t\tth.className = \"vrSchedulerDayResource\";\n\t\t\t\t\t\tth.setAttribute(\"resourceId\", resource.value);\n\t\t\t\t\t\tth.setAttribute(\"resourceName\", resourceText.replace(\" \", \"~\"));\n\t\t\t\t\t\trowHeader.appendChild(th);\n\n\t\t\t\t\t\t//#region Text\n\t\t\t\t\t\tlet spanResouceText = document.createElement(\"span\");\n\t\t\t\t\t\tspanResouceText.innerHTML = resourceText.toUpperCase();\n\t\t\t\t\t\tth.appendChild(spanResouceText);\n\t\t\t\t\t\t//#endregion\n\n\t\t\t\t\t\t//#region Saturation\n\t\t\t\t\t\tlet divSaturation = document.createElement(\"div\");\n\t\t\t\t\t\tdivSaturation.classList.add(\"vrSchedulerDivSaturation\");\n\t\t\t\t\t\tth.appendChild(divSaturation);\n\n\t\t\t\t\t\tif (this.saturationVisible())\n\t\t\t\t\t\t\tdivSaturation.style.cssText += \"display: flex;\";\n\n\t\t\t\t\t\tlet spanSaturationBar = document.createElement(\"span\");\n\t\t\t\t\t\tspanSaturationBar.classList.add(\"vrSchedulerSpanSaturation\");\n\t\t\t\t\t\tdivSaturation.appendChild(spanSaturationBar);\n\t\t\t\t\t\t//#endregion\n\t\t\t\t\t}\n\t\t\t\t\t//#endregion\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase SchedulerViewEnum.Week:\n\t\t\tcase SchedulerViewEnum.FourWeeks:\n\t\t\t\t{\n\t\t\t\t\t//#region Week/FourWeeks\n\t\t\t\t\tlet numberOfDays = (this.view() == SchedulerViewEnum.FourWeeks) ? options.numberOfWorkDays! * 4 : options.numberOfWorkDays!;\n\n\t\t\t\t\tif (!this.groupWeekByDate())\n\t\t\t\t\t{\n\t\t\t\t\t\t//#region GroupedByResources\n\t\t\t\t\t\tlet rowResources = document.createElement(\"tr\");\n\t\t\t\t\t\ttable.appendChild(rowResources);\n\n\t\t\t\t\t\tlet thInterval = document.createElement(\"th\");\n\t\t\t\t\t\tthInterval.className = \"vrSchedulerThInterval\";\n\t\t\t\t\t\trowResources.appendChild(thInterval);\n\t\t\t\t\t\tthis.createIntervalCombo(thInterval);\n\n\t\t\t\t\t\tlet rowDays = rowResources;\n\t\t\t\t\t\tif (this.groupedByResource())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfor (let resource of this.resources())\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlet resourceText = (resource.text != null) ? resource.text : \"\";\n\n\t\t\t\t\t\t\t\tlet th = document.createElement(\"th\");\n\t\t\t\t\t\t\t\tth.title = resourceText.toUpperCase();\n\t\t\t\t\t\t\t\tth.className = \"vrSchedulerDayResource\";\n\t\t\t\t\t\t\t\tth.setAttribute(\"resourceId\", resource.value);\n\t\t\t\t\t\t\t\tth.setAttribute(\"resourceName\", resourceText.replace(\" \", \"~\"));\n\t\t\t\t\t\t\t\tth.colSpan = numberOfDays;\n\t\t\t\t\t\t\t\trowResources.appendChild(th);\n\n\t\t\t\t\t\t\t\tif (this.resources().length > 1)\n\t\t\t\t\t\t\t\t\tth.classList.add(\"borderRightSolid\");\n\n\t\t\t\t\t\t\t\t//#region Text\n\t\t\t\t\t\t\t\tlet spanResouceText = document.createElement(\"span\");\n\t\t\t\t\t\t\t\tspanResouceText.innerHTML = resourceText.toUpperCase();\n\t\t\t\t\t\t\t\tth.appendChild(spanResouceText);\n\t\t\t\t\t\t\t\t//#endregion\n\n\t\t\t\t\t\t\t\t//#region Saturation\n\t\t\t\t\t\t\t\tlet spanSaturationPercentage = document.createElement(\"span\");\n\t\t\t\t\t\t\t\tspanSaturationPercentage.classList.add(\"vrSchedulerSaturationPercentage\");\n\t\t\t\t\t\t\t\tth.appendChild(spanSaturationPercentage);\n\t\t\t\t\t\t\t\t//#endregion\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\trowDays = document.createElement(\"tr\");\n\t\t\t\t\t\t\ttable.appendChild(rowDays);\n\n\t\t\t\t\t\t\tlet thInterval2 = document.createElement(\"th\");\n\t\t\t\t\t\t\tthInterval2.className = \"vrSchedulerThInterval\";\n\t\t\t\t\t\t\trowDays.appendChild(thInterval2);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfor (let resource of this.resources())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlet firstDayOfWeek = Date.vrGetFirstDayOfWeekByDate(this.date()!);\n\t\t\t\t\t\t\tlet addingDays = 0;\n\t\t\t\t\t\t\tfor (let i = 0; i < numberOfDays; i++)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\taddingDays = (i % options.numberOfWorkDays! == 0 && i > 0) ? addingDays + (7 - options.numberOfWorkDays!) : addingDays;\n\t\t\t\t\t\t\t\tlet dayOfWeek = firstDayOfWeek.vrAddDays(addingDays);\n\t\t\t\t\t\t\t\tlet dayName = options.daysOfWeekNames![dayOfWeek.getDay()];\n\t\t\t\t\t\t\t\tlet dayNumber = dayOfWeek.getDate();\n\n\t\t\t\t\t\t\t\tlet th = document.createElement(\"th\");\n\t\t\t\t\t\t\t\tth.title = dayOfWeek.vrToLongDateString();\n\t\t\t\t\t\t\t\tth.className = \"vrSchedulerWeekDay\";\n\t\t\t\t\t\t\t\tth.setAttribute(\"day\", String(dayNumber));\n\t\t\t\t\t\t\t\tth.setAttribute(\"month\", String(dayOfWeek.getMonth()));\n\t\t\t\t\t\t\t\tth.setAttribute(\"year\", String(dayOfWeek.getFullYear()));\n\t\t\t\t\t\t\t\tth.setAttribute(\"resourceId\", resource.value);\n\t\t\t\t\t\t\t\trowDays.appendChild(th);\n\n\t\t\t\t\t\t\t\tif (i == numberOfDays - 1)\n\t\t\t\t\t\t\t\t\tth.classList.add(\"borderRightSolid\");\n\n\t\t\t\t\t\t\t\tlet lastDateOfMonth = Date.vrGetLastDayOfMonthByDate(dayOfWeek);\n\t\t\t\t\t\t\t\tif (dayOfWeek.getDate() == lastDateOfMonth.getDate())\n\t\t\t\t\t\t\t\t\tth.classList.add(\"borderRightChangedMonth\");\n\n\t\t\t\t\t\t\t\t//#region Text\n\t\t\t\t\t\t\t\tlet spanResouceText = document.createElement(\"span\");\n\t\t\t\t\t\t\t\tspanResouceText.innerHTML = dayNumber + \" \" + dayName;\n\t\t\t\t\t\t\t\tth.appendChild(spanResouceText);\n\t\t\t\t\t\t\t\t//#endregion\n\n\t\t\t\t\t\t\t\t//#region Saturation\n\t\t\t\t\t\t\t\tlet divSaturation = document.createElement(\"div\");\n\t\t\t\t\t\t\t\tdivSaturation.classList.add(\"vrSchedulerDivSaturation\");\n\t\t\t\t\t\t\t\tth.appendChild(divSaturation);\n\n\t\t\t\t\t\t\t\tif (this.saturationVisible())\n\t\t\t\t\t\t\t\t\tdivSaturation.style.cssText += \"display: flex;\";\n\n\t\t\t\t\t\t\t\tlet spanSaturationBar = document.createElement(\"span\");\n\t\t\t\t\t\t\t\tspanSaturationBar.classList.add(\"vrSchedulerSpanSaturation\");\n\t\t\t\t\t\t\t\tdivSaturation.appendChild(spanSaturationBar);\n\t\t\t\t\t\t\t\t//#endregion\n\n\t\t\t\t\t\t\t\taddingDays++;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t//#endregion\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t//#region GroupedByDate\n\t\t\t\t\t\tlet rowDays = document.createElement(\"tr\");\n\t\t\t\t\t\ttable.appendChild(rowDays);\n\n\t\t\t\t\t\tlet thInterval = document.createElement(\"th\");\n\t\t\t\t\t\tthInterval.className = \"vrSchedulerThInterval\";\n\t\t\t\t\t\trowDays.appendChild(thInterval);\n\t\t\t\t\t\tthis.createIntervalCombo(thInterval);\n\n\t\t\t\t\t\tlet firstDayOfWeek = Date.vrGetFirstDayOfWeekByDate(this.date()!);\n\t\t\t\t\t\tlet addingDays = 0;\n\t\t\t\t\t\tfor (let i = 0; i < numberOfDays; i++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\taddingDays = (i % options.numberOfWorkDays! == 0 && i > 0) ? addingDays + (7 - options.numberOfWorkDays!) : addingDays;\n\t\t\t\t\t\t\tlet dayOfWeek = firstDayOfWeek.vrAddDays(addingDays);\n\t\t\t\t\t\t\tlet dayName = options.daysOfWeekNames![dayOfWeek.getDay()];\n\t\t\t\t\t\t\tlet dayNumber = dayOfWeek.getDate();\n\n\t\t\t\t\t\t\tlet th = document.createElement(\"th\");\n\t\t\t\t\t\t\tth.title = dayOfWeek.vrToLongDateString();\n\t\t\t\t\t\t\tth.colSpan = this.resources().length;\n\t\t\t\t\t\t\tth.className = \"vrSchedulerWeekDay\";\n\t\t\t\t\t\t\tth.setAttribute(\"day\", String(dayNumber));\n\t\t\t\t\t\t\tth.setAttribute(\"month\", String(dayOfWeek.getMonth()));\n\t\t\t\t\t\t\tth.setAttribute(\"year\", String(dayOfWeek.getFullYear()));\n\t\t\t\t\t\t\tth.innerHTML = dayNumber + \" \" + dayName;\n\t\t\t\t\t\t\tth.innerHTML = dayNumber + \" \" + dayName;\n\t\t\t\t\t\t\trowDays.appendChild(th);\n\n\t\t\t\t\t\t\tif (numberOfDays > 1)\n\t\t\t\t\t\t\t\tth.classList.add(\"borderRightSolid\");\n\n\t\t\t\t\t\t\tlet lastDateOfMonth = Date.vrGetLastDayOfMonthByDate(dayOfWeek);\n\t\t\t\t\t\t\tif (dayOfWeek.getDate() == lastDateOfMonth.getDate())\n\t\t\t\t\t\t\t\tth.classList.add(\"borderRightChangedMonth\");\n\n\t\t\t\t\t\t\taddingDays++;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tlet rowResources = document.createElement(\"tr\");\n\t\t\t\t\t\ttable.appendChild(rowResources);\n\n\t\t\t\t\t\tlet thInterval2 = document.createElement(\"th\");\n\t\t\t\t\t\tthInterval2.className = \"vrSchedulerThInterval\";\n\t\t\t\t\t\trowResources.appendChild(thInterval2);\n\n\t\t\t\t\t\tlet addingDaysForResources = 0;\n\t\t\t\t\t\tfor (let i = 0; i < numberOfDays; i++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\taddingDaysForResources = (i % options.numberOfWorkDays! == 0 && i > 0) ? addingDaysForResources + (7 - options.numberOfWorkDays!) : addingDaysForResources;\n\t\t\t\t\t\t\tlet dayOfWeek = firstDayOfWeek.vrAddDays(addingDaysForResources);\n\t\t\t\t\t\t\tlet dayNumber = dayOfWeek.getDate();\n\n\t\t\t\t\t\t\tlet j = 0;\n\t\t\t\t\t\t\tfor (let resource of this.resources())\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlet resourceText = (resource.text != null) ? resource.text : \"\";\n\n\t\t\t\t\t\t\t\tlet th = document.createElement(\"th\");\n\t\t\t\t\t\t\t\tth.title = resourceText.toUpperCase();\n\t\t\t\t\t\t\t\tth.className = \"vrSchedulerDayResource\";\n\t\t\t\t\t\t\t\tth.setAttribute(\"resourceId\", resource.value);\n\t\t\t\t\t\t\t\tth.setAttribute(\"resourceName\", resourceText.replace(\" \", \"~\"));\n\t\t\t\t\t\t\t\tth.setAttribute(\"day\", String(dayNumber));\n\t\t\t\t\t\t\t\tth.setAttribute(\"month\", String(dayOfWeek.getMonth()));\n\t\t\t\t\t\t\t\tth.setAttribute(\"year\", String(dayOfWeek.getFullYear()));\n\t\t\t\t\t\t\t\trowResources.appendChild(th);\n\n\t\t\t\t\t\t\t\tif (j == this.resources().length - 1)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tth.classList.add(\"borderRightSolid\");\n\n\t\t\t\t\t\t\t\t\tlet lastDateOfMonth = Date.vrGetLastDayOfMonthByDate(dayOfWeek);\n\t\t\t\t\t\t\t\t\tif (dayOfWeek.getDate() == lastDateOfMonth.getDate())\n\t\t\t\t\t\t\t\t\t\tth.classList.add(\"borderRightChangedMonth\");\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t//#region Text\n\t\t\t\t\t\t\t\tlet spanResouceText = document.createElement(\"span\");\n\t\t\t\t\t\t\t\tspanResouceText.innerHTML = resourceText.toUpperCase();;\n\t\t\t\t\t\t\t\tth.appendChild(spanResouceText);\n\t\t\t\t\t\t\t\t//#endregion\n\n\t\t\t\t\t\t\t\t//#region Saturation\n\t\t\t\t\t\t\t\tlet divSaturation = document.createElement(\"div\");\n\t\t\t\t\t\t\t\tdivSaturation.classList.add(\"vrSchedulerDivSaturation\");\n\t\t\t\t\t\t\t\tth.appendChild(divSaturation);\n\n\t\t\t\t\t\t\t\tif (this.saturationVisible())\n\t\t\t\t\t\t\t\t\tdivSaturation.style.cssText += \"display: flex;\";\n\n\t\t\t\t\t\t\t\tlet spanSaturationBar = document.createElement(\"span\");\n\t\t\t\t\t\t\t\tspanSaturationBar.classList.add(\"vrSchedulerSpanSaturation\");\n\t\t\t\t\t\t\t\tdivSaturation.appendChild(spanSaturationBar);\n\t\t\t\t\t\t\t\t//#endregion\n\n\t\t\t\t\t\t\t\tj++;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\taddingDaysForResources++;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t//#endregion\n\t\t\t\t\t}\n\t\t\t\t\t//#endregion\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t\tdivHeader.appendChild(contentFragment);\n\t}\n\n\tprivate createIntervalCombo(th: HTMLTableCellElement)\n\t{\n\t\tlet options = this.getOptions();\n\n\t\tif (this._cmbInterval != null)\n\t\t\tthis._cmbInterval.container().parentNode!.removeChild(this._cmbInterval.container());\n\n\t\tthis._cmbInterval = createComboBox({\n\t\t\tmode: ComboBoxTypeEnum.DropDown,\n\t\t\tvalue: options.timeslotIntervalDuration,\n\t\t\tcssContainer: \"top: 2px;\",\n\t\t\tpopupSettings: { width: 50 },\n\t\t\twidth: 60,\n\t\t\titems: [\n\t\t\t\t{ text: \"5 min\", value: \"5\" },\n\t\t\t\t{ text: \"10 min\", value: \"10\" },\n\t\t\t\t{ text: \"15 min\", value: \"15\" },\n\t\t\t\t{ text: \"25 min\", value: \"25\" },\n\t\t\t\t{ text: \"30 min\", value: \"30\" },\n\t\t\t\t{ text: \"60 min\", value: \"60\" }\n\t\t\t],\n\t\t\tonAfterChange: (e) => window.setTimeout(() => this.timeslotInterval(Number(e.sender.value()!)))\n\t\t}, th);\n\t}\n\n\tprivate drawContent()\n\t{\n\t\tlet options = this.getOptions();\n\t\tlet divContent = this.getDivContent();\n\t\tif (divContent == null)\n\t\t{\n\t\t\tdivContent = div(this.element(), { class: \"vrSchedulerDivContent\" });\n\n\t\t\tlet height: number | string = 0;\n\t\t\tif (options.height == null)\n\t\t\t{\n\t\t\t\tlet schedulerOffset = puma(this.container()).offset().top;\n\t\t\t\tlet contentHeight = window.innerHeight - schedulerOffset;\n\n\t\t\t\tlet toolbarHeight = puma(this.container()).find(\".vrSchedulerDivToolbar\").outerHeight();\n\t\t\t\tif (!options.showToolbar)\n\t\t\t\t\ttoolbarHeight = 0;\n\n\t\t\t\tlet headerHeight = puma(this.container()).find(\".vrSchedulerDivHeader\").outerHeight();\n\t\t\t\tif (!options.showHeader)\n\t\t\t\t\theaderHeight = 0;\n\n\t\t\t\theight = contentHeight - toolbarHeight - headerHeight;\n\t\t\t}\n\t\t\telse\n\t\t\t\theight = options.height;\n\n\t\t\tpuma(divContent).height(height);\n\t\t}\n\n\t\tpuma(divContent).empty();\n\t\tlet contentFragment = document.createDocumentFragment();\n\n\t\tlet table = document.createElement(\"table\");\n\t\ttable.style.cssText += \"width: 100%; table-layout: fixed; border-spacing: 0;\";\n\t\tcontentFragment.appendChild(table);\n\n\t\tlet schedulerTotalMinutes = Date.vrDifferenceBetweenDatesInMinutes(options.startTime!, options.endTime!);\n\t\tlet numberOfRows = schedulerTotalMinutes / options.timeslotIntervalDuration!;\n\t\tthis._slotElementList = [];\n\n\t\tswitch (this.view())\n\t\t{\n\t\t\tcase SchedulerViewEnum.Day:\n\t\t\t\t{\n\t\t\t\t\t//#region Day\n\t\t\t\t\tlet date = new Date(this.date()!.setHours(options.startTime!.getHours(), options.startTime!.getMinutes()));\n\t\t\t\t\tfor (let i = 0; i < numberOfRows; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tlet row = document.createElement(\"tr\");\n\t\t\t\t\t\ttable.appendChild(row);\n\n\t\t\t\t\t\tlet realDate = new Date(date);\n\t\t\t\t\t\trealDate.setSeconds(0, 0);\n\n\t\t\t\t\t\t// Time\n\t\t\t\t\t\tlet timeString = realDate.toTimeString();\n\t\t\t\t\t\tlet textTime = (i % 2 == 0) ? timeString : \"\";\n\n\t\t\t\t\t\tlet thTime = document.createElement(\"th\");\n\t\t\t\t\t\tthTime.innerHTML = textTime;\n\t\t\t\t\t\tthTime.classList.add(\"vrSchedulerThTime\");\n\t\t\t\t\t\tif (i % 2 == 0 && i > 0) thTime.classList.add(\"borderTopSolid\");\n\t\t\t\t\t\trow.appendChild(thTime);\n\n\t\t\t\t\t\tif (!options.timeColumn)\n\t\t\t\t\t\t\tthTime.style.cssText += \"display: none;\";\n\n\t\t\t\t\t\tlet endSlot = new Date(date);\n\t\t\t\t\t\tendSlot.vrAddMinutes(options.timeslotIntervalDuration!);\n\t\t\t\t\t\tendSlot.setSeconds(0, 0);\n\n\t\t\t\t\t\t// Slots\n\t\t\t\t\t\tlet columnIndex = 0;\n\t\t\t\t\t\tlet borderTopClass = (i == 0) ? \"\" : ((i % 2 == 0) ? \"borderTopSolid\" : \"borderTopDotted\");\n\t\t\t\t\t\tlet borderBottomClass = ((i == (numberOfRows - 1)) ? \"borderBottomSolid\" : \"\");\n\t\t\t\t\t\tfor (let resource of this.resources())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlet td = document.createElement(\"td\");\n\t\t\t\t\t\t\tif (borderTopClass != \"\") td.classList.add(borderTopClass);\n\t\t\t\t\t\t\tif (borderBottomClass != \"\") td.classList.add(borderBottomClass);\n\t\t\t\t\t\t\ttd.title = timeString;\n\t\t\t\t\t\t\trow.appendChild(td);\n\n\t\t\t\t\t\t\t// To fast appointment collocation\n\t\t\t\t\t\t\tlet slotElement = new SchedulerSlotElement();\n\t\t\t\t\t\t\tslotElement.resourceId = (resource != null) ? resource.value : \"0\";\n\t\t\t\t\t\t\tslotElement.start = realDate;\n\t\t\t\t\t\t\tslotElement.end = endSlot;\n\t\t\t\t\t\t\tslotElement.columnIndex = columnIndex;\n\t\t\t\t\t\t\tslotElement.rowIndex = i;\n\t\t\t\t\t\t\tthis._slotElementList.push(slotElement);\n\n\t\t\t\t\t\t\tcolumnIndex++;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tdate.vrAddMinutes(options.timeslotIntervalDuration!);\n\t\t\t\t\t}\n\t\t\t\t\t//#endregion\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase SchedulerViewEnum.Week:\n\t\t\tcase SchedulerViewEnum.FourWeeks:\n\t\t\t\t{\n\t\t\t\t\t//#region Week/FourWeeks\n\t\t\t\t\tlet numberOfDays = (this.view() == SchedulerViewEnum.FourWeeks) ? options.numberOfWorkDays! * 4 : options.numberOfWorkDays!;\n\t\t\t\t\tlet firstDayOfWeek = Date.vrGetFirstDayOfWeekByDate(this.date()!);\n\n\t\t\t\t\tlet minutes = Date.vrDifferenceBetweenDatesInMinutes(options.startTime!, options.endTime!);\n\t\t\t\t\tlet numberOfRows = minutes / options.timeslotIntervalDuration!;\n\n\t\t\t\t\tif (!this.groupWeekByDate())\n\t\t\t\t\t{\n\t\t\t\t\t\t//#region GroupedByResources\n\t\t\t\t\t\tlet date = new Date(options.startTime!);\n\t\t\t\t\t\tfor (let i = 0; i < numberOfRows; i++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlet row = document.createElement(\"tr\");\n\t\t\t\t\t\t\ttable.appendChild(row);\n\n\t\t\t\t\t\t\t// Time\n\t\t\t\t\t\t\tlet timeString = date.toTimeString();\n\t\t\t\t\t\t\tlet textTime = (i % 2 == 0) ? timeString : \"\";\n\n\t\t\t\t\t\t\tlet thTime = document.createElement(\"th\");\n\t\t\t\t\t\t\tthTime.innerHTML = textTime;\n\t\t\t\t\t\t\tthTime.classList.add(\"vrSchedulerThTime\");\n\t\t\t\t\t\t\tif (i % 2 == 0 && i > 0) thTime.classList.add(\"borderTopSolid\");\n\t\t\t\t\t\t\trow.appendChild(thTime);\n\n\t\t\t\t\t\t\tif (!options.timeColumn)\n\t\t\t\t\t\t\t\tthTime.style.cssText += \"display: none;\";\n\n\t\t\t\t\t\t\tlet borderTopClass = (i == 0) ? \"\" : ((i % 2 == 0) ? \"borderTopSolid\" : \"borderTopDotted\");\n\t\t\t\t\t\t\tlet borderBottomClass = (i == (numberOfRows - 1)) ? \"borderBottomSolid\" : \"\";\n\n\t\t\t\t\t\t\t// Slots\n\t\t\t\t\t\t\tlet columnIndex = 0;\n\t\t\t\t\t\t\tfor (let resource of this.resources())\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tfirstDayOfWeek.setHours(date.getHours(), date.getMinutes(), 0, 0);\n\n\t\t\t\t\t\t\t\tlet addingDays = 0;\n\t\t\t\t\t\t\t\tfor (let j = 0; j < numberOfDays; j++)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\taddingDays = (j % options.numberOfWorkDays! == 0 && j > 0) ? addingDays + (7 - options.numberOfWorkDays!) : addingDays;\n\t\t\t\t\t\t\t\t\tlet dayOfWeek = firstDayOfWeek.vrAddDays(addingDays);\n\t\t\t\t\t\t\t\t\tlet endSlot = new Date(dayOfWeek);\n\t\t\t\t\t\t\t\t\tendSlot.vrAddMinutes(options.timeslotIntervalDuration!);\n\n\t\t\t\t\t\t\t\t\tlet td = document.createElement(\"td\");\n\t\t\t\t\t\t\t\t\tif (borderTopClass != \"\") td.classList.add(borderTopClass);\n\t\t\t\t\t\t\t\t\tif (borderBottomClass != \"\") td.classList.add(borderBottomClass);\n\t\t\t\t\t\t\t\t\ttd.title = timeString;\n\t\t\t\t\t\t\t\t\trow.appendChild(td);\n\n\t\t\t\t\t\t\t\t\tif (j == numberOfDays - 1)\n\t\t\t\t\t\t\t\t\t\ttd.classList.add(\"borderRightSolid\");\n\n\t\t\t\t\t\t\t\t\tlet lastDateOfMonth = Date.vrGetLastDayOfMonthByDate(dayOfWeek);\n\t\t\t\t\t\t\t\t\tif (dayOfWeek.getDate() == lastDateOfMonth.getDate())\n\t\t\t\t\t\t\t\t\t\ttd.classList.add(\"borderRightChangedMonth\");\n\n\t\t\t\t\t\t\t\t\taddingDays++;\n\n\t\t\t\t\t\t\t\t\t// To fast appointment collocation\n\t\t\t\t\t\t\t\t\tlet slotElement = new SchedulerSlotElement();\n\t\t\t\t\t\t\t\t\tslotElement.resourceId = (resource != null) ? resource.value : \"0\";\n\t\t\t\t\t\t\t\t\tslotElement.start = dayOfWeek;\n\t\t\t\t\t\t\t\t\tslotElement.end = endSlot;\n\t\t\t\t\t\t\t\t\tslotElement.columnIndex = columnIndex;\n\t\t\t\t\t\t\t\t\tslotElement.rowIndex = i;\n\t\t\t\t\t\t\t\t\tthis._slotElementList.push(slotElement);\n\n\t\t\t\t\t\t\t\t\tcolumnIndex++;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tdate.vrAddMinutes(options.timeslotIntervalDuration!);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t//#endregion\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t//#region GroupedByDate\n\t\t\t\t\t\tlet date = new Date(options.startTime!);\n\t\t\t\t\t\tfor (let i = 0; i < numberOfRows; i++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlet row = document.createElement(\"tr\");\n\t\t\t\t\t\t\ttable.appendChild(row);\n\n\t\t\t\t\t\t\t// Time\n\t\t\t\t\t\t\tlet timeString = date.toTimeString();\n\t\t\t\t\t\t\tlet textTime = (i % 2 == 0) ? timeString : \"\";\n\n\t\t\t\t\t\t\tlet thTime = document.createElement(\"th\");\n\t\t\t\t\t\t\tthTime.innerHTML = textTime;\n\t\t\t\t\t\t\tthTime.classList.add(\"vrSchedulerThTime\");\n\t\t\t\t\t\t\tif (i % 2 == 0 && i > 0) thTime.classList.add(\"borderTopSolid\");\n\t\t\t\t\t\t\trow.appendChild(thTime);\n\n\t\t\t\t\t\t\tif (!options.timeColumn)\n\t\t\t\t\t\t\t\tthTime.style.cssText += \"display: none;\";\n\n\t\t\t\t\t\t\tlet borderTopClass = (i == 0) ? \"\" : ((i % 2 == 0) ? \"borderTopSolid\" : \"borderTopDotted\");\n\t\t\t\t\t\t\tlet borderBottomClass = (i == (numberOfRows - 1)) ? \"borderBottomSolid\" : \"\";\n\n\t\t\t\t\t\t\t// Slots\n\t\t\t\t\t\t\tlet columnIndex = 0;\n\t\t\t\t\t\t\tfor (let j = 0; j < numberOfDays; j++)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlet dayOfWeek = new Date(firstDayOfWeek);\n\t\t\t\t\t\t\t\tdayOfWeek.setHours(date.getHours(), date.getMinutes(), 0, 0);\n\t\t\t\t\t\t\t\tdayOfWeek = dayOfWeek.vrAddDays(j);\n\n\t\t\t\t\t\t\t\tfor (let resource of this.resources())\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tlet endSlot = new Date(dayOfWeek);\n\t\t\t\t\t\t\t\t\tendSlot.vrAddMinutes(options.timeslotIntervalDuration!);\n\n\t\t\t\t\t\t\t\t\tlet td = document.createElement(\"td\");\n\t\t\t\t\t\t\t\t\tif (borderTopClass != \"\") td.classList.add(borderTopClass);\n\t\t\t\t\t\t\t\t\tif (borderBottomClass != \"\") td.classList.add(borderBottomClass);\n\t\t\t\t\t\t\t\t\ttd.title = timeString;\n\t\t\t\t\t\t\t\t\trow.appendChild(td);\n\n\t\t\t\t\t\t\t\t\tif (((columnIndex + 1) % this.resources().length) == 0)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\ttd.classList.add(\"borderRightSolid\");\n\n\t\t\t\t\t\t\t\t\t\tlet lastDateOfMonth = Date.vrGetLastDayOfMonthByDate(dayOfWeek);\n\t\t\t\t\t\t\t\t\t\tif (dayOfWeek.getDate() == lastDateOfMonth.getDate())\n\t\t\t\t\t\t\t\t\t\t\ttd.classList.add(\"borderRightChangedMonth\");\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t// To fast appointment collocation\n\t\t\t\t\t\t\t\t\tlet slotElement = new SchedulerSlotElement();\n\t\t\t\t\t\t\t\t\tslotElement.resourceId = (resource != null) ? resource.value : \"0\";\n\t\t\t\t\t\t\t\t\tslotElement.start = dayOfWeek;\n\t\t\t\t\t\t\t\t\tslotElement.end = endSlot;\n\t\t\t\t\t\t\t\t\tslotElement.columnIndex = columnIndex;\n\t\t\t\t\t\t\t\t\tslotElement.rowIndex = i;\n\t\t\t\t\t\t\t\t\tthis._slotElementList.push(slotElement);\n\n\t\t\t\t\t\t\t\t\tcolumnIndex++;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tdate.vrAddMinutes(options.timeslotIntervalDuration!);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t//#endregion\n\t\t\t\t\t}\n\t\t\t\t\t//#endregion\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t}\n\t\tdivContent.appendChild(contentFragment);\n\n\t\t//#region Now line\n\t\tpuma(this.getDivContent()).remove(\".vrSchedulerNowLine\");\n\t\tlet nowDate = this.date()!;\n\t\tnowDate.setHours(new Date().getHours(), new Date().getMinutes(), 0, 0);\n\n\t\tlet nowTimeslot = this._slotElementList.filter(k => Date.vrArePeriodsOverlapped(k.start, k.end, nowDate, nowDate, true))[0];\n\t\tif (nowTimeslot != null)\n\t\t{\n\t\t\tlet divNowLine = puma(\"<div class='vrSchedulerNowLine'><i class='fa fa-caret-left'></i></div>\").vrAppendToPuma(this.getDivContent())[0];\n\t\t\tdivNowLine.style.cssText += \"left: \" + this._timeColumnWidth + \"px; top: \" + ((nowTimeslot.rowIndex * 33) - 1) + \"px; width: Calc(100% - \" + this._timeColumnWidth + \"px);\";\n\t\t}\n\t\t//#endregion\n\n\t\tthis.adaptHeight();\n\t}\n\n\tadaptHeight()\n\t{\n\t\tlet divContent = this.getDivContent();\n\t\tlet options = this.getOptions();\n\n\t\tlet height: number | string = 0;\n\t\tif (options.height == null)\n\t\t{\n\t\t\tlet schedulerOffset = puma(this.container()).offset().top;\n\t\t\tlet contentHeight = (window.innerHeight - schedulerOffset);\n\n\t\t\tlet toolbarHeight = puma(this.container()).find(\".vrSchedulerDivToolbar\").outerHeight();\n\t\t\tif (!options.showToolbar)\n\t\t\t\ttoolbarHeight = 0;\n\n\t\t\tlet headerHeight = puma(this.container()).find(\".vrSchedulerDivHeader\").outerHeight();\n\t\t\tif (!options.showHeader)\n\t\t\t\theaderHeight = 0;\n\n\t\t\tlet diff = toolbarHeight + headerHeight;\n\t\t\theight = contentHeight - diff;\n\t\t}\n\t\telse\n\t\t\theight = options.height;\n\n\t\tpuma(divContent).height(height);\n\t}\n\n\theight(value?: string | number)\n\t{\n\t\tlet height = super.height(value);\n\t\tpuma(this.getDivContent()).height(\"100%\");\n\t\treturn height;\n\t}\n\t//#endregion\n\n\t//#region Properties\n\tview(view?: SchedulerViewEnum, drawScheduler = true, triggerChange = true): SchedulerViewEnum\n\t{\n\t\tif (view != null)\n\t\t{\n\t\t\t//#region Event\n\t\t\tlet options = this.getOptions();\n\t\t\tif (options.onViewChange != null && triggerChange)\n\t\t\t{\n\t\t\t\tlet viewChangeEvent = new SchedulerViewChangeEvent();\n\t\t\t\tviewChangeEvent.sender = this;\n\t\t\t\tviewChangeEvent.previousView = this._actualView;\n\t\t\t\tviewChangeEvent.view = view;\n\t\t\t\toptions.onViewChange(viewChangeEvent);\n\n\t\t\t\tif (viewChangeEvent.isDefaultPrevented())\n\t\t\t\t\treturn this._actualView;\n\t\t\t}\n\n\t\t\tthis._actualView = view;\n\t\t\tthis._btgMenuView.select([view], false);\n\n\t\t\tif (drawScheduler)\n\t\t\t\tthis.drawScheduler();\n\t\t\t//#endregion\t\t\t\n\n\t\t\tswitch (view)\n\t\t\t{\n\t\t\t\tcase SchedulerViewEnum.Day:\n\t\t\t\t\t{\n\t\t\t\t\t\tthis._swtGroupByDateResource.hide();\n\t\t\t\t\t\tthis._dtpSchedulerDate.format(DateFormatEnum.LongDate);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase SchedulerViewEnum.Week:\n\t\t\t\t\t{\n\t\t\t\t\t\tthis._swtGroupByDateResource.show();\n\t\t\t\t\t\tthis._dtpSchedulerDate.format(DateFormatEnum.LongWeekRange);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase SchedulerViewEnum.FourWeeks:\n\t\t\t\t\t{\n\t\t\t\t\t\tthis._swtGroupByDateResource.hide();\n\t\t\t\t\t\tthis._dtpSchedulerDate.format(DateFormatEnum.LongFourWeeksRange);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (!this.groupedByResource())\n\t\t\t\tthis._swtGroupByDateResource.hide();\n\t\t}\n\t\treturn this._actualView;\n\t}\n\n\tdate(date?: Date, triggerChange = true): Date | null\n\t{\n\t\tlet options = this.getOptions();\n\t\tif (date != null)\n\t\t{\n\t\t\tif (this._dtpSchedulerDate.value() != date)\n\t\t\t\tthis._dtpSchedulerDate.value(date, false);\n\n\t\t\tif (this._dtpSchedulerDate.value() != null)\n\t\t\t\tthis.drawScheduler();\n\n\t\t\tif (options.onNavigate != null)\n\t\t\t{\n\t\t\t\tif (this._actualNavigateAction == null)\n\t\t\t\t\tthis._actualNavigateAction = SchedulerNavigateActionEnum.ChangeDate;\n\n\t\t\t\tif (triggerChange)\n\t\t\t\t{\n\t\t\t\t\tlet navigateEvent = new SchedulerNavigateEvent();\n\t\t\t\t\tnavigateEvent.sender = this;\n\t\t\t\t\tnavigateEvent.action = this._actualNavigateAction;\n\t\t\t\t\tnavigateEvent.previousDate = this._dtpSchedulerDate.value();\n\t\t\t\t\tnavigateEvent.date = date;\n\t\t\t\t\tnavigateEvent.view = this.view();\n\t\t\t\t\toptions.onNavigate!(navigateEvent);\n\t\t\t\t}\n\n\t\t\t\tthis._actualNavigateAction = null;\n\t\t\t}\n\t\t}\n\t\treturn this._dtpSchedulerDate.value();\n\t}\n\n\tresources(resources?: SchedulerResource[], drawScheduler = true, triggerChange = true)\n\t{\n\t\tlet options = this.getOptions();\n\t\tif (resources != null)\n\t\t{\n\t\t\tlet maxResourceNumberBasedOnView: number | null | undefined = null;\n\t\t\tswitch (this.view())\n\t\t\t{\n\t\t\t\tcase SchedulerViewEnum.Day: maxResourceNumberBasedOnView = options.maxResourcesNumber!.dayView; break;\n\t\t\t\tcase SchedulerViewEnum.Week: maxResourceNumberBasedOnView = options.maxResourcesNumber!.weekView; break;\n\t\t\t\tcase SchedulerViewEnum.FourWeeks: maxResourceNumberBasedOnView = options.maxResourcesNumber!.fourWeeksView; break;\n\t\t\t}\n\n\t\t\tif (maxResourceNumberBasedOnView != null && resources.length > maxResourceNumberBasedOnView)\n\t\t\t{\n\t\t\t\tconfirm(\"Stai impostando un numero di risorse maggiore<br /> del limite massimo impostato (\" + maxResourceNumberBasedOnView + \").<br /> Continuare comunque?\")\n\t\t\t\t\t.then(() =>\n\t\t\t\t\t{\n\t\t\t\t\t\toptions.resources = resources;\n\n\t\t\t\t\t\tif (drawScheduler)\n\t\t\t\t\t\t\tthis.drawScheduler();\n\n\t\t\t\t\t\tif (triggerChange)\n\t\t\t\t\t\t\tthis.triggerResourceChangeEvent();\n\t\t\t\t\t},\n\t\t\t\t\t\t() =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (triggerChange)\n\t\t\t\t\t\t\t\tthis.triggerResourceChangeEvent()\n\t\t\t\t\t\t}); // If not\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\toptions.resources = resources;\n\n\t\t\t\tif (drawScheduler)\n\t\t\t\t\tthis.drawScheduler();\n\n\t\t\t\tif (triggerChange)\n\t\t\t\t\tthis.triggerResourceChangeEvent();\n\t\t\t}\n\t\t}\n\t\treturn options.resources!;\n\t}\n\n\tgroupedByResource()\n\t{\n\t\treturn (this.resources().length > 1 || (this.resources()[0] != null && this.resources()[0].value != \"\"));\n\t}\n\n\tprivate triggerResourceChangeEvent()\n\t{\n\t\tlet options = this.getOptions();\n\t\tif (options.onResourcesChange != null)\n\t\t{\n\t\t\tlet resourcesChangeEvent = new SchedulerResourcesChangeEvent();\n\t\t\tresourcesChangeEvent.resources = options.resources!;\n\t\t\tresourcesChangeEvent.view = this.view();\n\t\t\tresourcesChangeEvent.sender = this;\n\t\t\toptions.onResourcesChange(resourcesChangeEvent);\n\t\t}\n\t}\n\n\ttimeslotInterval(timeslotIntervalDuration?: number, drawScheduler = true, triggerChange = true): number\n\t{\n\t\tlet options = this.getOptions();\n\t\tif (timeslotIntervalDuration != null)\n\t\t{\n\t\t\tif (options.onIntervalChange != null && triggerChange)\n\t\t\t{\n\t\t\t\tlet intervalChangeEvent = new SchedulerIntervalChangeEvent();\n\t\t\t\tintervalChangeEvent.sender = this;\n\t\t\t\tintervalChangeEvent.previousValue = options.timeslotIntervalDuration;\n\t\t\t\tintervalChangeEvent.value = timeslotIntervalDuration;\n\t\t\t\tintervalChangeEvent.view = this.view();\n\t\t\t\toptions.onIntervalChange(intervalChangeEvent);\n\n\t\t\t\tif (intervalChangeEvent.isDefaultPrevented())\n\t\t\t\t\treturn options.timeslotIntervalDuration!;\n\t\t\t}\n\n\t\t\toptions.timeslotIntervalDuration = timeslotIntervalDuration;\n\n\t\t\tif (drawScheduler)\n\t\t\t\tthis.drawScheduler();\n\t\t}\n\t\treturn options.timeslotIntervalDuration!;\n\t}\n\n\tdaysOfWeekNames(names?: string[], drawScheduler = true)\n\t{\n\t\tlet options = this.getOptions();\n\t\tif (names != null)\n\t\t{\n\t\t\toptions.daysOfWeekNames = names;\n\n\t\t\tif (drawScheduler)\n\t\t\t\tthis.drawScheduler();\n\t\t}\n\n\t\treturn options.daysOfWeekNames;\n\t}\n\n\tnumberOfWorkDays(workDaysNumber?: number, drawScheduler = true)\n\t{\n\t\tlet options = this.getOptions();\n\t\tif (workDaysNumber != null)\n\t\t{\n\t\t\toptions.numberOfWorkDays = workDaysNumber;\n\n\t\t\tif (drawScheduler)\n\t\t\t\tthis.drawScheduler();\n\t\t}\n\n\t\treturn options.numberOfWorkDays;\n\t}\n\n\tfirstDayOfWeek(): DayOfWeekEnum\n\t{\n\t\treturn this.getOptions().firstDayOfWeek!;\n\t}\n\n\tstartTime(time?: Date, drawScheduler = true): Date\n\t{\n\t\tlet options = this.getOptions();\n\t\tif (time != null)\n\t\t{\n\t\t\toptions.startTime = time;\n\n\t\t\tif (drawScheduler)\n\t\t\t\tthis.drawScheduler();\n\t\t}\n\t\treturn options.startTime!;\n\t}\n\n\tendTime(time?: Date, drawScheduler = true): Date\n\t{\n\t\tlet options = this.getOptions();\n\t\tif (time != null)\n\t\t{\n\t\t\toptions.endTime = time;\n\n\t\t\tif (drawScheduler)\n\t\t\t\tthis.drawScheduler();\n\t\t}\n\t\treturn options.endTime!;\n\t}\n\n\tmaxResourcesNumber(maxNumber?: SchedulerMaxResourceNumber)\n\t{\n\t\tlet options = this.getOptions();\n\t\tif (maxNumber != null)\n\t\t\toptions.maxResourcesNumber = maxNumber;\n\n\t\treturn options.maxResourcesNumber;\n\t}\n\n\tgroupWeekByDate(group?: boolean): boolean\n\t{\n\t\tif (group != null)\n\t\t{\n\t\t\tthis._swtGroupByDateResource.checked(group, false);\n\t\t\tthis.drawScheduler();\n\t\t\tthis.rebind();\n\t\t}\n\n\t\tif (this.view() != SchedulerViewEnum.Week)\n\t\t\treturn false;\n\n\t\treturn this._swtGroupByDateResource.checked();\n\t}\n\n\tfullscreen(state?: boolean)\n\t{\n\t\tif (state != null)\n\t\t{\n\t\t\tif (state) this._btnExpand.click();\n\t\t\telse this._btnCollapse.click();\n\t\t}\n\n\t\tlet doc = window.document as any;\n\t\treturn !(!doc.fullscreenElement && !doc.mozFullScreenElement && !doc.webkitFullscreenElement && !doc.msFullscreenElement);\n\t}\n\t//#endregion\n\n\t//#region Datasource\n\tdatasource<T extends SchedulerData>(datasource?: T[]): T[]\n\t{\n\t\tif (datasource != null && this._slotElementList.length > 0)\n\t\t{\n\t\t\tif (datasource.length == 0)\n\t\t\t{\n\t\t\t\tthis._datasource = datasource;\n\t\t\t\tpuma(this.container()).find(\".vrSchedulerAppointment\").remove();\n\t\t\t\treturn datasource;\n\t\t\t}\n\n\t\t\tlet options = this.getOptions();\n\n\t\t\t//#region Appointments on several days\n\t\t\tlet realDatasource = [];\n\t\t\tfor (let appointment of datasource)\n\t\t\t{\n\t\t\t\t(appointment as InternalSchedulerAppointment).positioned = false;\n\t\t\t\trealDatasource.push(appointment);\n\n\t\t\t\tlet end = new Date(appointment.end);\n\t\t\t\tlet start = new Date(appointment.start);\n\t\t\t\tlet daysDifference = Date.vrDifferenceBetweenDatesInDays(end, start);\n\t\t\t\tif (daysDifference > 1)\n\t\t\t\t{\n\t\t\t\t\tif (appointment.attributes == null) appointment.attributes = [];\n\t\t\t\t\tappointment.attributes.push({ key: \"multiday\", value: \"true\" });\n\n\t\t\t\t\tfor (let i = 1; i <= daysDifference; i++)\n\t\t\t\t\t{\n\t\t\t\t\t\tlet newApp = UtilityManager.duplicate(appointment) as T;\n\n\t\t\t\t\t\tlet newStart = start.vrAddDays(i);\n\t\t\t\t\t\tnewStart.setHours(this.startTime().getHours());\n\t\t\t\t\t\tnewApp.start = newStart;\n\t\t\t\t\t\tnewApp.end = new Date(newApp.start).vrAddHours(1);\n\n\t\t\t\t\t\tif (newApp.attributes == null) newApp.attributes = [];\n\t\t\t\t\t\tnewApp.attributes.push({ key: \"multiday\", value: \"true\" });\n\n\t\t\t\t\t\trealDatasource.push(newApp);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\t//#endregion\n\n\t\t\tdatasource = realDatasource;\n\n\t\t\tthis.checkMandatorySchedulerDataFields(datasource[0]);\n\t\t\tthis._datasource = datasource;\n\t\t\tpuma(this.container()).find(\".vrSchedulerAppointment\").remove();\n\n\t\t\tlet appointmentFragment = document.createDocumentFragment();\n\t\t\tlet slotWidthList: number[] = Array.from(puma(this.container()).find(\".vrSchedulerDivContent table tr:first-child td\")).map(k => { return puma(k).outerWidth() });\n\t\t\tlet slotWidth = slotWidthList[0];\n\n\t\t\tlet schedulerStartTime = new Date(options.startTime!);\n\n\t\t\t//#region Draw appointments\n\t\t\tlet dictionaryResourceAppointments: any = datasource.vrGroupBy(k => k.resourceId);\n\t\t\tfor (let appointment of datasource)\n\t\t\t{\n\t\t\t\tif ((appointment as InternalSchedulerAppointment).positioned == true)\n\t\t\t\t\tcontinue;\n\n\t\t\t\tif (appointment.resourceId != \"0\" && (this.resources()[0] == null || !this.resources().map(k => k.value).includes(String(appointment.resourceId))))\n\t\t\t\t\tcontinue;\n\n\t\t\t\t//#region Overlapped appointments\n\t\t\t\tlet resourceAppointments = dictionaryResourceAppointments[appointment.resourceId];\n\t\t\t\tlet appointmentsOverlapped = this.findOverlappedAppointments(appointment, resourceAppointments);\n\n\t\t\t\tlet maxOverlapped = 1;\n\t\t\t\tfor (let apt of appointmentsOverlapped)\n\t\t\t\t{\n\t\t\t\t\t// Find how many appointments in same slots per row\n\t\t\t\t\tfor (let slot of (apt as InternalSchedulerAppointment).slotsOccupied!)\n\t\t\t\t\t{\n\t\t\t\t\t\tslot.columnPosition = [];\n\t\t\t\t\t\tlet maxOverlappedSlot = 1;\n\t\t\t\t\t\tlet overlappedList: any[] = [];\n\t\t\t\t\t\tfor (let apt2 of appointmentsOverlapped)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (apt2.id == apt.id)\n\t\t\t\t\t\t\t\tcontinue;\n\n\t\t\t\t\t\t\tfor (let slot2 of (apt2 as InternalSchedulerAppointment).slotsOccupied!)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (Date.vrArePeriodsOverlapped(slot.start, slot.end, slot2.start, slot2.end))\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\toverlappedList.push(appointment);\n\t\t\t\t\t\t\t\t\tmaxOverlappedSlot++;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Get max overlapped number\n\t\t\t\t\t\tif (maxOverlappedSlot > maxOverlapped)\n\t\t\t\t\t\t\tmaxOverlapped = maxOverlappedSlot;\n\n\t\t\t\t\t\t(apt as InternalSchedulerAppointment).overlappedList = overlappedList.vrDistinctBy(k => k.id);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t//#endregion\n\n\t\t\t\tappointmentsOverlapped.vrSortDesc(\"duration\");\n\t\t\t\tfor (let apt of appointmentsOverlapped)\n\t\t\t\t{\n\t\t\t\t\t// Set correct dates based on timeslotInterval\n\t\t\t\t\tlet start = new Date(apt.start);\n\t\t\t\t\tthis.adaptDateToTimeslotDuration(start, SchedulerDateTypeEnum.Start);\n\n\t\t\t\t\tlet end = new Date(apt.end);\n\t\t\t\t\tthis.adaptDateToTimeslotDuration(end, SchedulerDateTypeEnum.End);\n\n\t\t\t\t\t// Find slot to position appointment\n\t\t\t\t\tlet slotFiltered: SchedulerSlotElement = (apt as InternalSchedulerAppointment).slotsOccupied![0];\n\t\t\t\t\tif (slotFiltered != null)\n\t\t\t\t\t{\n\t\t\t\t\t\t//#region If appointment starts before the scheduler's start time\n\t\t\t\t\t\tlet differenceFromStartTime = 0;\n\t\t\t\t\t\tlet schedulerStart = new Date(start);\n\t\t\t\t\t\tschedulerStart.setHours(schedulerStartTime.getHours(), schedulerStartTime.getMinutes());\n\t\t\t\t\t\tif (start.vrIsLessThan(schedulerStart))\n\t\t\t\t\t\t\tdifferenceFromStartTime = Date.vrDifferenceBetweenDatesInMinutes(start, schedulerStart);\n\t\t\t\t\t\t//#endregion\n\n\t\t\t\t\t\t//#region Position appointment\n\t\t\t\t\t\tlet duration = Date.vrDifferenceBetweenDatesInMinutes(start, end) - differenceFromStartTime;\n\t\t\t\t\t\tlet timeslotInterval = this.timeslotInterval();\n\t\t\t\t\t\tlet height = Math.round(duration / timeslotInterval) * 33 + duration / timeslotInterval - 6;\n\t\t\t\t\t\theight -= Math.round(duration / timeslotInterval);\n\n\t\t\t\t\t\t//#region Fix max height\n\t\t\t\t\t\tlet maxPositionY = this._slotElementList[this._slotElementList.length - 1].rowIndex * 33 + 33;\n\t\t\t\t\t\tlet finalAppointmentPositionY = (slotFiltered.rowIndex * 33) + height;\n\t\t\t\t\t\tif (finalAppointmentPositionY > maxPositionY)\n\t\t\t\t\t\t\theight = height - (finalAppointmentPositionY - maxPositionY) - 1;\n\t\t\t\t\t\t//#endregion\n\n\t\t\t\t\t\t//#region Know if a piece of slot is already occupied\n\t\t\t\t\t\tlet occupiedSlotList = (apt as InternalSchedulerAppointment).slotsOccupied!.map(k => k.columnPosition);\n\t\t\t\t\t\tlet index = 0;\n\t\t\t\t\t\tfor (let i = 0; i < maxOverlapped; i++)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tlet goTo = true;\n\t\t\t\t\t\t\tindex = i;\n\t\t\t\t\t\t\tfor (let occupiedSlot of occupiedSlotList)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (occupiedSlot[i] == true)\n\t\t\t\t\t\t\t\t\tgoTo = false;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (goTo)\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t//#endregion\n\n\t\t\t\t\t\t// Fix width\n\t\t\t\t\t\tlet width = (slotWidth * 85 / 100) / maxOverlapped;\n\t\t\t\t\t\twidth = width;\n\t\t\t\t\t\tif (width <= 0)\n\t\t\t\t\t\t\twidth = 1;\n\n\t\t\t\t\t\t// Get xPosition\n\t\t\t\t\t\tlet slotFilteredWidth = slotWidthList.slice(0, slotFiltered.columnIndex).vrSum();\n\t\t\t\t\t\tlet newSlotFilteredWidth = slotWidthList[0] * slotFiltered.columnIndex; // 21/06/2021 - old: slotFilteredWidth + this._timeColumnWidth\n\t\t\t\t\t\tlet positionX = newSlotFilteredWidth + (index * width) + index + this._timeColumnWidth;\n\n\t\t\t\t\t\t// Set slot as occupied at specified index\n\t\t\t\t\t\tfor (let slot of (apt as InternalSchedulerAppointment).slotsOccupied!)\n\t\t\t\t\t\t\tslot.columnPosition[index] = true;\n\n\t\t\t\t\t\t// Draw appointment\n\t\t\t\t\t\tlet divAppointment = document.createElement(\"div\");\n\t\t\t\t\t\tdivAppointment.style.cssText += \"top: \" + (slotFiltered.rowIndex * 33) + \"px; left: \" + positionX + \"px;\";\n\t\t\t\t\t\tdivAppointment.className = \"vrSchedulerAppointment\";\n\n\t\t\t\t\t\t//#region Width/Height\n\t\t\t\t\t\tdivAppointment.style.cssText += \"width: \" + width + \"px; height: \" + height + \"px;\";\n\t\t\t\t\t\t//#endregion\n\n\t\t\t\t\t\tthis.managePropertiesSchedulerData(divAppointment, apt);\n\t\t\t\t\t\tappointmentFragment.appendChild(divAppointment);\n\t\t\t\t\t\t//#endregion\n\n\t\t\t\t\t\t//#region Move appointment\n\t\t\t\t\t\tpuma(divAppointment).on(\"mousedown\", (emd: JQuery.MouseDownEvent) =>\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (!this.enabled() || !options.editable!.move || this._isResizing)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\temd.preventDefault();\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// Main mouse button (usually left)\n\t\t\t\t\t\t\tif (emd.button != 0)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\temd.preventDefault();\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tlet schedulerOffsetTop = puma(this.getDivContent()).offset().top;\n\t\t\t\t\t\t\tlet schedulerScrollOffset = this.getDivContent().scrollTop;\n\t\t\t\t\t\t\tlet schedulerOffsetLeft = puma(this.getDivContent()).offset().left;\n\n\t\t\t\t\t\t\tlet slotToMove: SchedulerSlotElement | null = null;\n\n\t\t\t\t\t\t\t//#region Starting position\n\t\t\t\t\t\t\tlet startingXPosition = emd.clientX;\n\t\t\t\t\t\t\tlet startingYPosition = emd.clientY;\n\t\t\t\t\t\t\tlet slotStartingPosition: SchedulerSlotElement | null = null;\n\t\t\t\t\t\t\tlet sum = 0;\n\t\t\t\t\t\t\tlet slotColumnIndex = 0;\n\t\t\t\t\t\t\tfor (let slotsss of slotWidthList)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tsum += slotsss;\n\t\t\t\t\t\t\t\tif ((sum + this._timeColumnWidth) > startingXPosition)\n\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\tslotColumnIndex++;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tslotStartingPosition = this._slotElementList[slotColumnIndex];\n\t\t\t\t\t\t\tlet diffYMouseAppointment = Math.abs(divAppointment.offsetTop - (emd.clientY + schedulerScrollOffset - schedulerOffsetTop));\n\t\t\t\t\t\t\t//#endregion\n\n\t\t\t\t\t\t\tpuma(document).on(\"mousemove\", (emm: MouseEvent) =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (!this.enabled() || !options.editable!.move || this._isResizing)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\temm.preventDefault();\n\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// Position of the mouse\n\t\t\t\t\t\t\t\tlet xPositionMouse = emm.clientX - schedulerOffsetLeft;\n\t\t\t\t\t\t\t\tlet yPositionMouse = emm.clientY + schedulerScrollOffset - schedulerOffsetTop;\n\n\t\t\t\t\t\t\t\t// Position of appointment\n\t\t\t\t\t\t\t\tlet appointmentYPosition = divAppointment.offsetTop;\n\t\t\t\t\t\t\t\tlet appointmentHeight = divAppointment.clientHeight;\n\t\t\t\t\t\t\t\tlet appointmentXPosition = divAppointment.offsetLeft;\n\t\t\t\t\t\t\t\tlet appointmentWidth = divAppointment.clientWidth;\n\n\t\t\t\t\t\t\t\t// Sensibility\n\t\t\t\t\t\t\t\tif (yPositionMouse >= appointmentYPosition && yPositionMouse <= (appointmentYPosition + appointmentHeight)\n\t\t\t\t\t\t\t\t\t&& xPositionMouse >= appointmentXPosition && xPositionMouse <= (appointmentXPosition + appointmentWidth)\n\t\t\t\t\t\t\t\t\t&& slotToMove == null)\n\t\t\t\t\t\t\t\t\tslotToMove = null;\n\t\t\t\t\t\t\t\t// If it is only a click\n\t\t\t\t\t\t\t\telse if (emm.clientX == startingXPosition && emm.clientY == startingYPosition)\n\t\t\t\t\t\t\t\t\tslotToMove = null;\n\t\t\t\t\t\t\t\t// If you are moving\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tlet appointmentDataSource = null;\n\t\t\t\t\t\t\t\t\tif (apt.resourceId != null)\n\t\t\t\t\t\t\t\t\t\tappointmentDataSource = this.datasource().filter(k => k.id == divAppointment.id && k.resourceId == apt.resourceId)[0];\n\t\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\t\tappointmentDataSource = this.datasource().filter(k => k.id == divAppointment.id)[0];\n\n\t\t\t\t\t\t\t\t\tlet appointmentIndex = this.datasource().indexOf(appointmentDataSource);\n\t\t\t\t\t\t\t\t\tappointmentDataSource = this.datasource()[appointmentIndex];\n\n\t\t\t\t\t\t\t\t\t//#region Find slot\n\t\t\t\t\t\t\t\t\tlet sum = 0;\n\t\t\t\t\t\t\t\t\tlet slotColumnIndex = 0;\n\t\t\t\t\t\t\t\t\tfor (let slotsss of slotWidthList)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tsum += slotsss;\n\t\t\t\t\t\t\t\t\t\tif ((sum + this._timeColumnWidth) > xPositionMouse)\n\t\t\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\t\t\tslotColumnIndex++;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tslotToMove = this._slotElementList.filter(k => k.columnIndex == slotColumnIndex && k.rowIndex == Math.trunc((yPositionMouse - diffYMouseAppointment) / 33))[0];\n\t\t\t\t\t\t\t\t\t//#endregion\n\n\t\t\t\t\t\t\t\t\tlet duration = Date.vrDifferenceBetweenDatesInMinutes(apt.end, apt.start);\n\t\t\t\t\t\t\t\t\tlet start = new Date(apt.start);\n\t\t\t\t\t\t\t\t\tlet end = new Date(start).vrAddMinutes(duration);\n\n\t\t\t\t\t\t\t\t\tlet options = this.getOptions();\n\t\t\t\t\t\t\t\t\tif (options.onMoveStart != null && !this._isMoving)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t//#region Move start event\n\t\t\t\t\t\t\t\t\t\tthis._isMoving = true;\n\n\t\t\t\t\t\t\t\t\t\tlet moveAppointmentEvent = new SchedulerMoveStartEvent();\n\t\t\t\t\t\t\t\t\t\tmoveAppointmentEvent.sender = this;\n\t\t\t\t\t\t\t\t\t\tmoveAppointmentEvent.divElement = divAppointment;\n\t\t\t\t\t\t\t\t\t\tmoveAppointmentEvent.start = start;\n\t\t\t\t\t\t\t\t\t\tmoveAppointmentEvent.end = end;\n\t\t\t\t\t\t\t\t\t\tmoveAppointmentEvent.dataItem = appointmentDataSource;\n\t\t\t\t\t\t\t\t\t\tmoveAppointmentEvent.resourceId = slotStartingPosition!.resourceId;\n\t\t\t\t\t\t\t\t\t\toptions.onMoveStart(moveAppointmentEvent);\n\n\t\t\t\t\t\t\t\t\t\tif (moveAppointmentEvent.isDefaultPrevented())\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\temm.preventDefault();\n\t\t\t\t\t\t\t\t\t\t\tpuma(document).unbind(\"mouseup\");\n\t\t\t\t\t\t\t\t\t\t\tpuma(document).unbind(\"mousemove\");\n\t\t\t\t\t\t\t\t\t\t\tslotToMove = null;\n\t\t\t\t\t\t\t\t\t\t\tthis._isMoving = false;\n\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t//#endregion\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\telse if (options.onMoving != null)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t//#region Moving event\n\t\t\t\t\t\t\t\t\t\tstart = new Date(slotToMove.start);\n\t\t\t\t\t\t\t\t\t\tend = new Date(slotToMove.start).vrAddMinutes(duration);\n\n\t\t\t\t\t\t\t\t\t\tlet moveAppointmentEvent = new SchedulerMovingEvent();\n\t\t\t\t\t\t\t\t\t\tmoveAppointmentEvent.sender = this;\n\t\t\t\t\t\t\t\t\t\tmoveAppointmentEvent.divElement = divAppointment;\n\t\t\t\t\t\t\t\t\t\tmoveAppointmentEvent.start = start;\n\t\t\t\t\t\t\t\t\t\tmoveAppointmentEvent.end = end;\n\t\t\t\t\t\t\t\t\t\tmoveAppointmentEvent.dataItem = appointmentDataSource;\n\t\t\t\t\t\t\t\t\t\tmoveAppointmentEvent.resourceId = slotToMove.resourceId;\n\t\t\t\t\t\t\t\t\t\toptions.onMoving(moveAppointmentEvent);\n\n\t\t\t\t\t\t\t\t\t\tif (moveAppointmentEvent.isDefaultPrevented())\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\temm.preventDefault();\n\t\t\t\t\t\t\t\t\t\t\tpuma(document).unbind(\"mouseup\");\n\t\t\t\t\t\t\t\t\t\t\tpuma(document).unbind(\"mousemove\");\n\t\t\t\t\t\t\t\t\t\t\tslotToMove = null;\n\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t//#endregion\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tlet yMovePosition = Math.trunc((yPositionMouse - diffYMouseAppointment) / 33) * 33;\n\t\t\t\t\t\t\t\t\tlet xMovePosition = slotWidthList.slice(0, slotToMove.columnIndex).vrSum() + this._timeColumnWidth;\n\n\t\t\t\t\t\t\t\t\tdivAppointment.style.top = yMovePosition + \"px\";\n\t\t\t\t\t\t\t\t\tdivAppointment.style.left = xMovePosition + \"px\";\n\n\t\t\t\t\t\t\t\t\tdivAppointment.classList.add(\"vrSchedulerAppointmentMoving\");\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t\t// Stop moving\n\t\t\t\t\t\t\tpuma(document).on(\"mouseup\", () =>\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (!this.enabled() || !options.editable!.move || this._isResizing)\n\t\t\t\t\t\t\t\t\treturn;\n\n\t\t\t\t\t\t\t\tpuma(document).unbind(\"mouseup\");\n\t\t\t\t\t\t\t\tpuma(document).unbind(\"mousemove\");\n\n\t\t\t\t\t\t\t\tpuma(divAppointment).removeClass(\"vrSchedulerAppointmentMoving\");\n\t\t\t\t\t\t\t\tpuma(this.getDivContent()).remove(\".vrSchedulerAppointmentMoving\");\n\n\t\t\t\t\t\t\t\twindow.setTimeout(() => this._isMoving = false, 100);\n\t\t\t\t\t\t\t\tif (slotToMove != null)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tlet duration = Date.vrDifferenceBetweenDatesInMinutes(apt.end, apt.start);\n\t\t\t\t\t\t\t\t\tlet start = new Date(slotToMove.start);\n\t\t\t\t\t\t\t\t\tlet end = new Date(start).vrAddMinutes(duration);\n\n\t\t\t\t\t\t\t\t\tlet appointmentDataSource = null;\n\t\t\t\t\t\t\t\t\tif (apt.resourceId != null)\n\t\t\t\t\t\t\t\t\t\tappointmentDataSource = this.datasource().filter(k => k.id == divAppointment.id && k.resourceId == apt.resourceId)[0];\n\t\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\t\tappointmentDataSource = this.datasource().filter(k => k.id == divAppointment.id)[0];\n\n\t\t\t\t\t\t\t\t\t//#region Move end event\n\t\t\t\t\t\t\t\t\tlet options = this.getOptions();\n\t\t\t\t\t\t\t\t\tif (options.onMoveEnd != null)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tlet moveAppointmentEvent = new SchedulerMoveEndEvent();\n\t\t\t\t\t\t\t\t\t\tmoveAppointmentEvent.sender = this;\n\t\t\t\t\t\t\t\t\t\tmoveAppointmentEvent.divElement = divAppointment;\n\t\t\t\t\t\t\t\t\t\tmoveAppointmentEvent.start = start;\n\t\t\t\t\t\t\t\t\t\tmoveAppointmentEvent.end = end;\n\t\t\t\t\t\t\t\t\t\tmoveAppointmentEvent.dataItem = appointmentDataSource;\n\t\t\t\t\t\t\t\t\t\tmoveAppointmentEvent.resourceId = slotToMove.resourceId;\n\t\t\t\t\t\t\t\t\t\toptions.onMoveEnd(moveAppointmentEvent);\n\n\t\t\t\t\t\t\t\t\t\tif (moveAppointmentEvent.isDefaultPrevented())\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tslotToMove = null;\n\t\t\t\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t//#endregion\n\n\t\t\t\t\t\t\t\t\t//#region Update appointment into datasource\n\t\t\t\t\t\t\t\t\tlet appointmentIndex = this.datasource().indexOf(appointmentDataSource);\n\t\t\t\t\t\t\t\t\tappointmentDataSource = this.datasource()[appointmentIndex];\n\t\t\t\t\t\t\t\t\tappointmentDataSource.start = start;\n\t\t\t\t\t\t\t\t\tappointmentDataSource.end = end;\n\t\t\t\t\t\t\t\t\tappointmentDataSource.resourceId = slotToMove.resourceId;\n\t\t\t\t\t\t\t\t\t//#endregion\n\n\t\t\t\t\t\t\t\t\tslotToMove = null;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t\t//#endregion\n\n\t\t\t\t\t\t//#region Resize appointment\n\t\t\t\t\t\tthis.setResizing(divAppointment, apt);\n\t\t\t\t\t\t//#endregion\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.getDivContent().appendChild(appointmentFragment);\n\t\t\t//#endregion\n\t\t}\n\t\treturn (this._datasource == null) ? [] : this._datasource as T[];\n\t}\n\n\tprivate setResizing(divAppointment: HTMLDivElement, apt: SchedulerData)\n\t{\n\t\tlet options = this.getOptions();\n\t\tif (!this.enabled() || !options.editable!.resize)\n\t\t\treturn;\n\n\t\tlet divResizable = document.createElement(\"div\");\n\t\tdivResizable.classList.add(\"vrSchedulerDivResize\");\n\n\t\tlet divInside = document.createElement(\"div\");\n\t\tdivInside.classList.add(\"vrSchedulerDivResizeInside\");\n\t\tdivResizable.appendChild(divInside);\n\t\tdivAppointment.appendChild(divResizable);\n\n\t\tpuma(divAppointment).on(\"mouseover\", (e: JQuery.MouseOverEvent) => divResizable.style.display = \"block\");\n\t\tpuma(divAppointment).on(\"mouseout\", (e: JQuery.MouseOutEvent) => divResizable.style.display = \"none\");\n\n\t\tlet pageY: number | null = null;\n\t\tlet slotToResize: SchedulerSlotElement | null;\n\n\t\tlet schedulerOffsetTop = puma(this.getDivContent()).offset().top;\n\t\tlet schedulerScrollOffset = this.getDivContent().scrollTop;\n\t\tlet schedulerOffsetLeft = puma(this.getDivContent()).offset().left;\n\n\t\tlet resizing = false;\n\n\t\t//#region Div events\n\t\tpuma(divResizable).on(\"mousedown\", (e: JQuery.MouseDownEvent) =>\n\t\t{\n\t\t\t// Main mouse button (usually left)\n\t\t\tif (e.button != 0)\n\t\t\t{\n\t\t\t\te.preventDefault();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._isResizing = true;\n\t\t\tpageY = e.pageY;\n\t\t\tlet divAppointmentHeight = divAppointment!.offsetHeight;\n\n\t\t\t//#region Document events\n\t\t\tpuma(document).on(\"mousemove\", (e: JQuery.MouseMoveEvent) =>\n\t\t\t{\n\t\t\t\tif (divAppointment != null)\n\t\t\t\t{\n\t\t\t\t\tlet appointmentDataSource = null;\n\t\t\t\t\tif (apt.resourceId != null)\n\t\t\t\t\t\tappointmentDataSource = this.datasource().filter(k => k.id == divAppointment.id && k.resourceId == apt.resourceId)[0];\n\t\t\t\t\telse\n\t\t\t\t\t\tappointmentDataSource = this.datasource().filter(k => k.id == divAppointment.id)[0];\n\n\t\t\t\t\tlet appointmentIndex = this.datasource().indexOf(appointmentDataSource);\n\t\t\t\t\tappointmentDataSource = this.datasource()[appointmentIndex];\n\n\t\t\t\t\t// Position of the mouse\n\t\t\t\t\tlet xPositionMouse = e.clientX - schedulerOffsetLeft;\n\t\t\t\t\tlet yPositionMouse = e.clientY + schedulerScrollOffset - schedulerOffsetTop;\n\n\t\t\t\t\tslotToResize = this._slotElementList.filter(k => k.resourceId == apt.resourceId && k.rowIndex == Math.trunc(yPositionMouse / 33))[0];\n\n\t\t\t\t\tif (options.onResizeStart != null && !resizing)\n\t\t\t\t\t{\n\t\t\t\t\t\t//#region Move start event\n\t\t\t\t\t\tthis._isResizing = true;\n\t\t\t\t\t\tresizing = true;\n\n\t\t\t\t\t\tlet resizeStartEvent = new SchedulerResizeStartEvent();\n\t\t\t\t\t\tresizeStartEvent.sender = this;\n\t\t\t\t\t\tresizeStartEvent.divElement = divAppointment;\n\t\t\t\t\t\tresizeStartEvent.start = apt.start;\n\t\t\t\t\t\tresizeStartEvent.end = apt.end;\n\t\t\t\t\t\tresizeStartEvent.dataItem = appointmentDataSource;\n\t\t\t\t\t\tresizeStartEvent.resourceId = apt.resourceId;\n\t\t\t\t\t\toptions.onResizeStart(resizeStartEvent);\n\n\t\t\t\t\t\tif (resizeStartEvent.isDefaultPrevented())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\tpuma(document).unbind(\"mouseup\");\n\t\t\t\t\t\t\tpuma(document).unbind(\"mousemove\");\n\t\t\t\t\t\t\tslotToResize = null;\n\t\t\t\t\t\t\tthis._isResizing = false;\n\t\t\t\t\t\t\tresizing = false;\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t//#endregion\n\t\t\t\t\t}\n\t\t\t\t\telse if (options.onResizing != null)\n\t\t\t\t\t{\n\t\t\t\t\t\t//#region Moving event\n\t\t\t\t\t\tlet resizingEvent = new SchedulerResizingEvent();\n\t\t\t\t\t\tresizingEvent.sender = this;\n\t\t\t\t\t\tresizingEvent.divElement = divAppointment;\n\t\t\t\t\t\tresizingEvent.start = apt.start;\n\t\t\t\t\t\tresizingEvent.end = slotToResize.end;\n\t\t\t\t\t\tresizingEvent.dataItem = appointmentDataSource;\n\t\t\t\t\t\tresizingEvent.resourceId = apt.resourceId;\n\t\t\t\t\t\toptions.onResizing(resizingEvent);\n\n\t\t\t\t\t\tif (resizingEvent.isDefaultPrevented())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\te.preventDefault();\n\t\t\t\t\t\t\tpuma(document).unbind(\"mouseup\");\n\t\t\t\t\t\t\tpuma(document).unbind(\"mousemove\");\n\t\t\t\t\t\t\tslotToResize = null;\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\t//#endregion\n\t\t\t\t\t}\n\n\t\t\t\t\tlet diffY = e.pageY - pageY!;\n\t\t\t\t\tlet diffToAdd = Math.trunc(diffY / 33) * 33;\n\t\t\t\t\tlet height = (divAppointmentHeight! + diffToAdd);\n\t\t\t\t\theight -= height % 33;\n\t\t\t\t\tdivAppointment.style.height = height + \"px\";\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tpuma(document).on(\"mouseup\", () =>\n\t\t\t{\n\t\t\t\tpuma(document).unbind(\"mouseup\");\n\t\t\t\tpuma(document).unbind(\"mousemove\");\n\t\t\t\twindow.setTimeout(() => this._isResizing = false, 100);\n\n\t\t\t\tif (slotToResize != null)\n\t\t\t\t{\n\t\t\t\t\tlet appointmentDataSource = null;\n\t\t\t\t\tif (apt.resourceId != null)\n\t\t\t\t\t\tappointmentDataSource = this.datasource().filter(k => k.id == divAppointment.id && k.resourceId == apt.resourceId)[0];\n\t\t\t\t\telse\n\t\t\t\t\t\tappointmentDataSource = this.datasource().filter(k => k.id == divAppointment.id)[0];\n\n\t\t\t\t\t//#region Move end event\n\t\t\t\t\tlet options = this.getOptions();\n\t\t\t\t\tif (options.onResizeEnd != null)\n\t\t\t\t\t{\n\t\t\t\t\t\tlet moveAppointmentEvent = new SchedulerMoveEndEvent();\n\t\t\t\t\t\tmoveAppointmentEvent.sender = this;\n\t\t\t\t\t\tmoveAppointmentEvent.divElement = divAppointment;\n\t\t\t\t\t\tmoveAppointmentEvent.start = apt.start;\n\t\t\t\t\t\tmoveAppointmentEvent.end = slotToResize.end;\n\t\t\t\t\t\tmoveAppointmentEvent.dataItem = apt;\n\t\t\t\t\t\tmoveAppointmentEvent.resourceId = apt.resourceId;\n\t\t\t\t\t\toptions.onResizeEnd(moveAppointmentEvent);\n\n\t\t\t\t\t\tif (moveAppointmentEvent.isDefaultPrevented())\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tslotToResize = null;\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\t//#endregion\n\n\t\t\t\t\t//#region Update appointment into datasource\n\t\t\t\t\tlet appointmentIndex = this.datasource().indexOf(appointmentDataSource);\n\t\t\t\t\tappointmentDataSource = this.datasource()[appointmentIndex];\n\t\t\t\t\tappointmentDataSource.start = apt.start;\n\t\t\t\t\tappointmentDataSource.end = slotToResize.end;\n\t\t\t\t\tappointmentDataSource.resourceId = apt.resourceId;\n\t\t\t\t\t//#endregion\n\n\t\t\t\t\tslotToResize = null;\n\t\t\t\t\tpageY = null;\n\t\t\t\t}\n\t\t\t});\n\t\t\t//#endregion\n\t\t});\n\t}\n\n\tavailabilities<T extends SchedulerData>(availabilities?: T[]): T[]\n\t{\n\t\tif (availabilities != null)\n\t\t{\n\t\t\tif (availabilities.length == 0)\n\t\t\t{\n\t\t\t\tthis._availabilities = [];\n\t\t\t\tpuma(this.container()).find(\".vrSchedulerAvailability\").remove();\n\t\t\t\treturn this._availabilities as T[];\n\t\t\t}\n\n\t\t\tlet options = this.getOptions();\n\t\t\tthis.checkMandatorySchedulerDataFields(availabilities[0]);\n\t\t\tthis._availabilities = availabilities;\n\n\t\t\tpuma(this.container()).find(\".vrSchedulerAvailability\").remove();\n\n\t\t\tlet availabilityFragment = document.createDocumentFragment();\n\t\t\tlet slotWidthList = Array.from(puma(this.container()).find(\".vrSchedulerDivContent table tr:first-child td\")).map(k => { return puma(k).outerWidth() });\n\t\t\tlet totalMinutes = Date.vrDifferenceBetweenDatesInMinutes(options.startTime!, options.endTime!);\n\n\t\t\tlet contentHeight = puma(this.getDivContent()).find(\"table\").height();\n\t\t\tfor (let availability of availabilities)\n\t\t\t{\n\t\t\t\t// Fixed date\n\t\t\t\tlet dateFrom = Date.vrConvertDateFromServer(new Date(availability.start));\n\t\t\t\tlet dateTo = Date.vrConvertDateFromServer(new Date(availability.end));\n\n\t\t\t\tlet slotForAvailability: SchedulerSlotElement = this._slotElementList.filter(k => (availability.resourceId == k.resourceId || availability.resourceId == null) && Date.vrArePeriodsOverlapped(k.start, k.end, dateFrom, dateTo))[0];\n\t\t\t\tif (slotForAvailability != null)\n\t\t\t\t{\n\t\t\t\t\t// Get xPosition\n\t\t\t\t\tlet newSlotFilteredWidth = slotWidthList[0] * slotForAvailability.columnIndex;\n\t\t\t\t\tlet positionX = newSlotFilteredWidth + this._timeColumnWidth;\n\t\t\t\t\tlet positionY = slotForAvailability.rowIndex * 33;\n\n\t\t\t\t\t//#region Height\n\t\t\t\t\tlet duration = Date.vrDifferenceBetweenDatesInMinutes(slotForAvailability.start, availability.end);\n\t\t\t\t\tif (duration > totalMinutes)\n\t\t\t\t\t\tduration = totalMinutes;\n\n\t\t\t\t\tlet height = Math.round(duration / this.timeslotInterval()) * 33;\n\t\t\t\t\theight = height - (height % 33);\n\t\t\t\t\tif (height <= 0)\n\t\t\t\t\t\theight = 33;\n\n\t\t\t\t\tif ((positionY + height) > contentHeight)\n\t\t\t\t\t\theight -= ((positionY + height) - contentHeight);\n\t\t\t\t\t//#endregion\n\n\t\t\t\t\t// Draw availability\n\t\t\t\t\tlet divAvailability = document.createElement(\"div\");\n\t\t\t\t\tdivAvailability.style.cssText = \"top: \" + positionY + \"px; left: \" + positionX + \"px;\";\n\t\t\t\t\tdivAvailability.className = \"vrSchedulerAvailability\";\n\n\t\t\t\t\t//#region Width/Height\n\t\t\t\t\tdivAvailability.style.cssText += \"width: \" + slotWidthList[slotForAvailability.columnIndex] + \"px; height: \" + height + \"px;\";\n\t\t\t\t\t//#endregion\n\n\t\t\t\t\tthis.managePropertiesSchedulerData(divAvailability, availability);\n\t\t\t\t\tavailabilityFragment.appendChild(divAvailability);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis.getDivContent().appendChild(availabilityFragment);\n\t\t}\n\t\treturn this._availabilities as T[];\n\t}\n\n\tprivate checkMandatorySchedulerDataFields(schedulerData: SchedulerData)\n\t{\n\t\tlet error = [];\n\t\tif (schedulerData.id == null)\n\t\t\terror.push(\"id\");\n\t\tif (schedulerData.start == null)\n\t\t\terror.push(\"start\");\n\t\tif (schedulerData.end == null)\n\t\t\terror.push(\"end\");\n\n\t\tif (error.length > 0)\n\t\t\tthrow Error(\"Prevedere i seguenti campi: \" + error.toString());\n\t}\n\n\tprivate managePropertiesSchedulerData(divElement: HTMLElement, schedulerData: SchedulerData)\n\t{\n\t\tdivElement.id = schedulerData.id;\n\n\t\t//#region Color\n\t\tif (schedulerData.tooltip != null)\n\t\t\tdivElement.setAttribute(\"title\", schedulerData.tooltip);\n\n\t\tif (schedulerData.backgroundColor != null)\n\t\t\tdivElement.style.backgroundColor = schedulerData.backgroundColor;\n\n\t\tif (schedulerData.textColor != null)\n\t\t\tdivElement.style.color = schedulerData.textColor;\n\t\t//#endregion\n\n\t\t//#region Text\n\t\tif (schedulerData.text != null)\n\t\t\tdivElement.insertAdjacentHTML(\"afterbegin\", schedulerData.text);\n\t\t//#endregion\n\n\t\t//#region Custom CSS/Class\n\t\tif (schedulerData.css != null && schedulerData.css != \"\")\n\t\t\tdivElement.style.cssText += schedulerData.css;\n\n\t\tif (schedulerData.class != null && schedulerData.class != \"\")\n\t\t\tdivElement.classList.add(schedulerData.class);\n\t\t//#endregion\n\n\t\t//#region Attributes\n\t\tdivElement.setAttribute(\"resourceId\", schedulerData.resourceId);\n\t\tdivElement.setAttribute(\"start\", schedulerData.start.toString());\n\t\tdivElement.setAttribute(\"end\", schedulerData.end.toString());\n\n\t\tif (schedulerData.attributes != null)\n\t\t{\n\t\t\tfor (let attribute of schedulerData.attributes)\n\t\t\t\tdivElement.setAttribute(attribute.key, attribute.value);\n\t\t}\n\t\t//#endregion\n\t}\n\n\trebind(appointments = true, availabilities = true)\n\t{\n\t\tif (appointments) this.rebindAppointments();\n\t\tif (availabilities) this.rebindAvailabilities();\n\t}\n\n\trebindAppointments()\n\t{\n\t\tthis.datasource(this._datasource);\n\t}\n\n\trebindAvailabilities()\n\t{\n\t\tthis.availabilities(this._availabilities);\n\t}\n\t//#endregion\n\n\t//#region Saturation\n\tsaturation(saturationData?: SchedulerSaturationInfo)\n\t{\n\t\tif (saturationData != null)\n\t\t{\n\t\t\tif (saturationData.manual == null) saturationData.manual = false;\n\t\t\tthis._saturationData = saturationData;\n\n\t\t\tthis._saturationVisible = true;\n\t\t\tif (!saturationData.manual)\n\t\t\t\tthis.internalHideSaturation();\n\n\t\t\tswitch (this.view())\n\t\t\t{\n\t\t\t\tcase SchedulerViewEnum.Day:\n\t\t\t\t\t{\n\t\t\t\t\t\t//#region Day\n\t\t\t\t\t\tlet saturationDay = saturationData.dayMode;\n\t\t\t\t\t\tif (saturationDay != null)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfor (let saturation of saturationDay)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tif (saturation.date != null && typeof (saturation.date) == \"string\")\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tsaturation.date = new Date(saturation.date);\n\t\t\t\t\t\t\t\t\tsaturation.date.setHours(0, 0, 0);\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tlet schedulerDate = this.date();\n\t\t\t\t\t\t\t\tschedulerDate!.setHours(0, 0, 0);\n\t\t\t\t\t\t\t\tif (saturation.date != null && !Date.vrEquals(saturation.date, schedulerDate!))\n\t\t\t\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t\t\t\tlet divSaturation = puma(\".vrSchedulerDayResource[resourceId='\" + saturation.resourceId + \"'] .vrSchedulerDivSaturation\")[0];\n\t\t\t\t\t\t\t\tlet spanPercentage = puma(\".vrSchedulerDayResource[resourceId='\" + saturation.resourceId + \"'] .vrSchedulerSpanSaturation\")[0];\n\t\t\t\t\t\t\t\tthis.manageSaturationPercentage(saturation, divSaturation, spanPercentage);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tthis.adaptHeight();\n\t\t\t\t\t\t}\n\t\t\t\t\t\t//#endregion\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase SchedulerViewEnum.Week:\n\t\t\t\t\t{\n\t\t\t\t\t\t//#region Week\n\t\t\t\t\t\tlet saturationWeek = saturationData.weekMode;\n\t\t\t\t\t\tif (saturationWeek != null)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (!this.groupWeekByDate())\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t//#region GroupedByResources\n\t\t\t\t\t\t\t\tlet saturationWeekGroupedByResource = saturationWeek.groupedByResource;\n\t\t\t\t\t\t\t\tif (saturationWeekGroupedByResource != null)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tfor (let saturation of saturationWeekGroupedByResource)\n\t\t\t\t\t\t\t\t\t\tthis.manageWeekDateList(saturation);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t//#endregion\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t//#region GroupedByDate\n\t\t\t\t\t\t\t\tlet saturationWeekGroupedByDate = saturationWeek.groupedByDate;\n\t\t\t\t\t\t\t\tif (saturationWeekGroupedByDate != null)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tfor (let saturation of saturationWeekGroupedByDate)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tif (typeof (saturation.date) == \"string\")\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tsaturation.date = new Date(saturation.date);\n\t\t\t\t\t\t\t\t\t\t\tsaturation.date.setHours(0, 0, 0);\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\tlet day = saturation.date.getDate();\n\t\t\t\t\t\t\t\t\t\tlet month = saturation.date.getMonth();\n\t\t\t\t\t\t\t\t\t\tlet year = saturation.date.getFullYear();\n\n\t\t\t\t\t\t\t\t\t\tif (saturation.resourceList != null)\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tfor (let saturationResource of saturation.resourceList)\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tlet thResource = puma(\".vrSchedulerDayResource[resourceId='\" + saturationResource.id + \"'][day='\" + day + \"'][month='\" + month + \"'][year='\" + year + \"']\")[0];\n\t\t\t\t\t\t\t\t\t\t\t\tif (thResource != null)\n\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\tlet divSaturation = puma(thResource).find(\".vrSchedulerDivSaturation\")[0];\n\t\t\t\t\t\t\t\t\t\t\t\t\tlet spanPercentage = puma(thResource).find(\".vrSchedulerSpanSaturation\")[0];\n\t\t\t\t\t\t\t\t\t\t\t\t\tthis.manageSaturationPercentage(saturationResource, divSaturation, spanPercentage);\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t//#endregion\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tthis.adaptHeight();\n\t\t\t\t\t\t}\n\t\t\t\t\t\t//#endregion\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase SchedulerViewEnum.FourWeeks:\n\t\t\t\t\t{\n\t\t\t\t\t\t//#region FourWeeks\n\t\t\t\t\t\tlet saturationFourWeeks = saturationData.fourWeeksMode;\n\t\t\t\t\t\tif (saturationFourWeeks != null)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfor (let saturation of saturationFourWeeks)\n\t\t\t\t\t\t\t\tthis.manageWeekDateList(saturation);\n\n\t\t\t\t\t\t\tthis.adaptHeight();\n\t\t\t\t\t\t}\n\t\t\t\t\t\t//#endregion\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\treturn this._saturationData;\n\t}\n\n\tprivate manageSaturationPercentage(saturation: SchedulerSaturationDay | SaturationResource, divSaturation: HTMLElement, spanPercentage: HTMLElement)\n\t{\n\t\tlet borderColor = (saturation.borderColor != null) ? saturation.borderColor : \"#CCC\";\n\t\tif (divSaturation != null)\n\t\t\tdivSaturation.style.cssText += \"border-color: \" + borderColor + \";\";\n\n\t\tlet color = (saturation.color != null) ? saturation.color : \"#bbb8b8\";\n\t\tif (spanPercentage != null)\n\t\t{\n\t\t\tpuma(spanPercentage).width(saturation.percentageValue + \"%\");\n\t\t\tspanPercentage.style.cssText += \"background-color: \" + color + \";\";\n\t\t\tspanPercentage.parentElement!.title = saturation.percentageValue + \"%\";\n\n\t\t\tif (saturation.percentageValue != null)\n\t\t\t\tpuma(spanPercentage).parent().css(\"display\", \"flex\");\n\t\t}\n\t}\n\n\tprivate manageWeekDateList(saturation: SchedulerSaturationWeekByResource | SchedulerSaturationFourWeeks)\n\t{\n\t\tlet spanPercentageResource = puma(\".vrSchedulerDayResource[resourceId='\" + saturation.resourceId + \"'] .vrSchedulerSaturationPercentage\")[0];\n\t\tif (spanPercentageResource != null)\n\t\t{\n\t\t\tpuma(spanPercentageResource).show();\n\t\t\tspanPercentageResource.innerHTML = \" \" + ((saturation.percentageValue != null) ? saturation.percentageValue : \"\") + \"%\";\n\n\t\t\tif (saturation.titleColor == null) saturation.titleColor = \"#000\";\n\t\t\tspanPercentageResource.style.cssText += \"color: \" + saturation.titleColor;\n\t\t}\n\n\t\tif (saturation.dateList != null)\n\t\t{\n\t\t\tfor (let saturationDate of saturation.dateList)\n\t\t\t{\n\t\t\t\tif (typeof (saturationDate.date) == \"string\")\n\t\t\t\t{\n\t\t\t\t\tsaturationDate.date = new Date(saturationDate.date);\n\t\t\t\t\tsaturationDate.date.setHours(0, 0, 0);\n\t\t\t\t}\n\n\t\t\t\tlet color = (saturationDate.color != null) ? saturationDate.color : \"#bbb8b8\";\n\t\t\t\tlet day = saturationDate.date.getDate();\n\t\t\t\tlet month = saturationDate.date.getMonth();\n\t\t\t\tlet year = saturationDate.date.getFullYear();\n\n\t\t\t\tlet thWeekDay = puma(\".vrSchedulerWeekDay[resourceId='\" + saturation.resourceId + \"'][day='\" + day + \"'][month='\" + month + \"'][year='\" + year + \"']\")[0];\n\t\t\t\tif (thWeekDay != null)\n\t\t\t\t{\n\t\t\t\t\tlet divSaturation = puma(thWeekDay).find(\".vrSchedulerDivSaturation\")[0];\n\t\t\t\t\tlet borderColor = (saturationDate.borderColor != null) ? saturationDate.borderColor : \"#CCC\";\n\t\t\t\t\tif (divSaturation != null)\n\t\t\t\t\t\tdivSaturation.style.cssText += \"border-color: \" + borderColor + \";\";\n\n\t\t\t\t\tlet spanPercentage = puma(thWeekDay).find(\".vrSchedulerSpanSaturation\")[0];\n\t\t\t\t\tif (spanPercentage != null)\n\t\t\t\t\t{\n\t\t\t\t\t\tpuma(spanPercentage).width(saturationDate.percentageValue + \"%\");\n\t\t\t\t\t\tspanPercentage.style.cssText += \"background-color: \" + color + \";\";\n\t\t\t\t\t\tspanPercentage.parentElement!.title = saturationDate.percentageValue + \"%\";\n\n\t\t\t\t\t\tif (saturationDate.percentageValue != null)\n\t\t\t\t\t\t\tpuma(spanPercentage).parent().css(\"display\", \"flex\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tclearSaturation()\n\t{\n\t\tthis._saturationData = undefined;\n\t\tthis.hideSaturation();\n\t}\n\n\tshowSaturation()\n\t{\n\t\tthis.internalShowSaturation();\n\t\tthis._saturationVisible = true;\n\t}\n\n\tprivate internalShowSaturation()\n\t{\n\t\tfor (let divSaturation of Array.from<HTMLElement>(puma(\".vrSchedulerDivSaturation\")))\n\t\t\tdivSaturation.style.cssText += \"display: flex;\";\n\n\t\tpuma(\".vrSchedulerSaturationPercentage\").show();\n\t\tthis.adaptHeight();\n\t}\n\n\thideSaturation()\n\t{\n\t\tthis.internalHideSaturation();\n\t\tthis._saturationVisible = false;\n\t}\n\n\tprivate internalHideSaturation()\n\t{\n\t\tpuma(\".vrSchedulerDivSaturation\").hide();\n\t\tpuma(\".vrSchedulerSaturationPercentage\").hide();\n\t\tthis.adaptHeight();\n\t}\n\n\tsaturationVisible()\n\t{\n\t\treturn this._saturationVisible;\n\t}\n\t//#endregion\n\n\t//#region Methods\n\tbounceAppointment(divElementId: string)\n\t{\n\t\tif (!divElementId.startsWith(\"#\"))\n\t\t\tdivElementId = \"#\" + divElementId;\n\n\t\tlet divAppointment = puma(divElementId)[0];\n\t\tif (divAppointment != null)\n\t\t{\n\t\t\tdivAppointment.classList.add(\"vrSchedulerAppointmentAnimated\");\n\t\t\tdivAppointment.classList.add(\"vrSchedulerAppointmentBounce\");\n\t\t}\n\t}\n\n\tprivate manageSchedulerClick()\n\t{\n\t\tpuma(this.element()).on(\"click\", \".vrSchedulerDivContent td, .vrSchedulerAppointment, .vrSchedulerAvailability\", (e: any) =>\n\t\t{\n\t\t\tlet options = this.getOptions();\n\t\t\tif (!this.enabled())\n\t\t\t\treturn;\n\n\t\t\tlet target = puma(e.currentTarget);\n\t\t\tlet schedulerOffsetTop = puma(this.getDivContent()).offset().top;\n\t\t\tlet schedulerScrollOffset = this.getDivContent().scrollTop;\n\t\t\tlet schedulerOffsetLeft = puma(this.getDivContent()).offset().left;\n\n\t\t\tlet slotWidth = puma(this.container()).find(\".vrSchedulerDivContent table td\").outerWidth();\n\t\t\tlet xPositionMouse = e.clientX - schedulerOffsetLeft;\n\t\t\tlet yPositionMouse = e.clientY + schedulerScrollOffset - schedulerOffsetTop;\n\t\t\tlet slotElement = this._slotElementList.filter(k => k.columnIndex == (Math.trunc((xPositionMouse - 63) / slotWidth)) && k.rowIndex == Math.trunc(yPositionMouse / 33))[0];\n\t\t\tif (slotElement == null)\n\t\t\t\treturn;\n\n\t\t\tlet duplicatedSlotElement = UtilityManager.duplicate(slotElement);\n\t\t\tduplicatedSlotElement.start = new Date(duplicatedSlotElement.start);\n\t\t\tduplicatedSlotElement.end = new Date(duplicatedSlotElement.end);\n\n\t\t\t// 0 = Main mouse button (usually left)\n\t\t\tif (e.button == 0 && !this._isMoving && !this._isResizing)\n\t\t\t{\n\t\t\t\tif (target.hasClass(\"vrSchedulerAppointment\"))\n\t\t\t\t{\n\t\t\t\t\tlet appointmentDataSource = this.datasource().filter(k => k.id == target[0].id)[0];\n\t\t\t\t\tlet duration = Date.vrDifferenceBetweenDatesInMinutes(appointmentDataSource.end, appointmentDataSource.start);\n\t\t\t\t\tlet start = new Date(appointmentDataSource.start);\n\t\t\t\t\tlet end = new Date(start).vrAddMinutes(duration);\n\n\t\t\t\t\t//#region Click on appointment\n\t\t\t\t\tif (options.onAppointmentClick != null)\n\t\t\t\t\t{\n\t\t\t\t\t\tlet clickOnAppointmentEvent = new SchedulerAppointmentClickEvent();\n\t\t\t\t\t\tclickOnAppointmentEvent.sender = this;\n\t\t\t\t\t\tclickOnAppointmentEvent.slotElement = duplicatedSlotElement;\n\t\t\t\t\t\tclickOnAppointmentEvent.start = start;\n\t\t\t\t\t\tclickOnAppointmentEvent.end = end;\n\t\t\t\t\t\tclickOnAppointmentEvent.resourceId = appointmentDataSource.resourceId;\n\t\t\t\t\t\tclickOnAppointmentEvent.dataItem = appointmentDataSource;\n\t\t\t\t\t\tclickOnAppointmentEvent.element = target[0];\n\t\t\t\t\t\toptions.onAppointmentClick(clickOnAppointmentEvent);\n\t\t\t\t\t}\n\t\t\t\t\t//#endregion\n\t\t\t\t}\n\t\t\t\telse if (target.hasClass(\"vrSchedulerAvailability\"))\n\t\t\t\t{\n\t\t\t\t\tlet availabilityDataSource = this.availabilities().filter(k => k.id == target[0].id)[0];\n\t\t\t\t\tlet duration = Date.vrDifferenceBetweenDatesInMinutes(availabilityDataSource.end, availabilityDataSource.start);\n\t\t\t\t\tlet start = new Date(availabilityDataSource.start);\n\t\t\t\t\tlet end = new Date(start).vrAddMinutes(duration);\n\n\t\t\t\t\t//#region Click on availability\n\t\t\t\t\tif (options.onAvailabilityClick != null)\n\t\t\t\t\t{\n\t\t\t\t\t\tlet clickOnAvailabilityEvent = new SchedulerAvailabilityClickEvent();\n\t\t\t\t\t\tclickOnAvailabilityEvent.sender = this;\n\t\t\t\t\t\tclickOnAvailabilityEvent.slotElement = duplicatedSlotElement;\n\t\t\t\t\t\tclickOnAvailabilityEvent.start = start;\n\t\t\t\t\t\tclickOnAvailabilityEvent.end = end;\n\t\t\t\t\t\tclickOnAvailabilityEvent.resourceId = availabilityDataSource.resourceId;\n\t\t\t\t\t\tclickOnAvailabilityEvent.dataItem = availabilityDataSource;\n\t\t\t\t\t\tclickOnAvailabilityEvent.element = target[0];\n\t\t\t\t\t\toptions.onAvailabilityClick(clickOnAvailabilityEvent);\n\t\t\t\t\t}\n\t\t\t\t\t//#endregion\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t//#region Click on timeslot\n\t\t\t\t\tif (options.onTimeslotClick != null)\n\t\t\t\t\t{\n\t\t\t\t\t\tlet clickOnTimeslotEvent = new SchedulerTimeslotClickEvent();\n\t\t\t\t\t\tclickOnTimeslotEvent.sender = this;\n\t\t\t\t\t\tclickOnTimeslotEvent.slotElement = duplicatedSlotElement;\n\t\t\t\t\t\tclickOnTimeslotEvent.start = duplicatedSlotElement.start;\n\t\t\t\t\t\tclickOnTimeslotEvent.end = duplicatedSlotElement.end;\n\t\t\t\t\t\tclickOnTimeslotEvent.resourceId = slotElement.resourceId;\n\t\t\t\t\t\tclickOnTimeslotEvent.element = target[0];\n\t\t\t\t\t\toptions.onTimeslotClick(clickOnTimeslotEvent);\n\t\t\t\t\t}\n\t\t\t\t\t//#endregion\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tthis._isMoving = false;\n\t\t\t\tthis._isResizing = false;\n\t\t\t}\n\t\t});\n\n\t\tpuma(this.element()).on(\"click\", \".vrSchedulerDayResource\", (e: any) =>\n\t\t{\n\t\t\t// Only if left key\n\t\t\tif (e.button == 0)\n\t\t\t{\n\t\t\t\tlet target = puma(e.currentTarget);\n\t\t\t\tlet resourceId = target[0].getAttribute(\"resourceId\")!;\n\t\t\t\tlet resourceName = target[0].getAttribute(\"resourceName\")!.replace(\"~\", \" \");\n\n\t\t\t\tlet resource = new SchedulerResource();\n\t\t\t\tresource.value = resourceId;\n\t\t\t\tresource.text = resourceName;\n\t\t\t\tthis.resources([resource]);\n\n\t\t\t\tthis.view(SchedulerViewEnum.FourWeeks);\n\t\t\t}\n\t\t});\n\n\t\tpuma(this.element()).on(\"click\", \".vrSchedulerWeekDay\", (e: any) =>\n\t\t{\n\t\t\t// Only if left key\n\t\t\tif (e.button == 0)\n\t\t\t{\n\t\t\t\tlet target = puma(e.currentTarget);\n\t\t\t\tlet day = target[0].getAttribute(\"day\")!;\n\t\t\t\tlet month = target[0].getAttribute(\"month\")!;\n\t\t\t\tlet year = target[0].getAttribute(\"year\")!;\n\n\t\t\t\tthis.view(SchedulerViewEnum.Day);\n\t\t\t\tlet date = new Date(year, month, day);\n\t\t\t\tthis.date(date);\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate getDivContent(): HTMLElement\n\t{\n\t\treturn puma(this.container()).find(\".vrSchedulerDivContent\")[0];\n\t}\n\t//#endregion\n\n\t//#region Utilities\n\tprivate findOverlappedAppointments(appointment: SchedulerData, resourceAppointments: SchedulerData[]): SchedulerData[]\n\t{\n\t\t// Set correct dates based on timeslotInterval\n\t\tlet start = new Date(appointment.start);\n\t\tthis.adaptDateToTimeslotDuration(start, SchedulerDateTypeEnum.Start);\n\n\t\tlet end = new Date(appointment.end);\n\t\tthis.adaptDateToTimeslotDuration(end, SchedulerDateTypeEnum.End);\n\n\t\t// Get appointment slots\n\t\tlet appointmentSlots = this.getAppointmentSlots(appointment);\n\n\t\tlet appointmentsOverlapped: any[] = [];\n\t\t(appointment as InternalSchedulerAppointment).positioned = true;\n\t\t(appointment as InternalSchedulerAppointment).slotsOccupied = appointmentSlots;\n\t\tappointmentsOverlapped.push(appointment);\n\n\t\t// Get overlapped appointments\n\t\tfor (let resAppointment of resourceAppointments)\n\t\t{\n\t\t\tif ((resAppointment as InternalSchedulerAppointment).positioned)\n\t\t\t\tcontinue;\n\n\t\t\t// Set dates based on timeslotInterval\n\t\t\tlet resAppointmentStart = new Date(resAppointment.start);\n\t\t\tthis.adaptDateToTimeslotDuration(resAppointmentStart, SchedulerDateTypeEnum.Start);\n\n\t\t\tlet resAppointmentEnd = new Date(resAppointment.end);\n\t\t\tthis.adaptDateToTimeslotDuration(resAppointmentEnd, SchedulerDateTypeEnum.End);\n\n\t\t\t// If overlap\n\t\t\tif (/*start.getDate() == resAppointmentStart.getDate() && end.getDate() == resAppointmentEnd.getDate()\n\t\t\t\t&&*/ start < resAppointmentEnd && end > resAppointmentStart)\n\t\t\t{\n\t\t\t\tlet overlappedList = this.findOverlappedAppointments(resAppointment, resourceAppointments);\n\t\t\t\tfor (let overlappedApt of overlappedList)\n\t\t\t\t\tappointmentsOverlapped.push(overlappedApt);\n\t\t\t}\n\t\t}\n\t\treturn appointmentsOverlapped;\n\t}\n\n\tprivate adaptDateToTimeslotDuration(date: Date, dateType: SchedulerDateTypeEnum)\n\t{\n\t\tlet minutes = date.getMinutes();\n\t\tlet timeslotInterval = this.timeslotInterval();\n\n\t\tif (dateType == SchedulerDateTypeEnum.Start)\n\t\t{\n\t\t\tif (minutes % timeslotInterval > 0)\n\t\t\t\tdate.setMinutes(minutes - (minutes % timeslotInterval));\n\t\t}\n\t\telse if (dateType == SchedulerDateTypeEnum.End)\n\t\t{\n\t\t\tif (minutes % timeslotInterval > 0)\n\t\t\t\tdate.setMinutes(minutes + (timeslotInterval - (minutes % timeslotInterval)));\n\t\t}\n\t\treturn date;\n\t}\n\n\tprivate getAppointmentSlots(appointment: SchedulerData): SchedulerSlotElement[]\n\t{\n\t\tlet start = new Date(appointment.start);\n\t\tlet end = new Date(appointment.end);\n\t\treturn this._slotElementList.filter(k => (appointment.resourceId == k.resourceId || appointment.resourceId == null) && k.start.getDate() == start.getDate() && Date.vrArePeriodsOverlapped(k.start, k.end, start, end));\n\t}\n\n\texportPdf(fileName = \"Calendario.pdf\", onlyVisible = false, autoPrint = false, loader = true)\n\t{\n\t\tif (loader)\n\t\t\tshowLoader();\n\n\t\tif (!onlyVisible)\n\t\t\tpuma(this.container()).find(\".vrSchedulerDivContent\")[0].style.cssText += \"height: unset;\";\n\n\t\twindow.setTimeout(() =>\n\t\t{\n\t\t\thtml2canvas(this.container()).then((canvas: any) =>\n\t\t\t{\n\t\t\t\t//#region Height and Width\n\t\t\t\tlet elementWidth = $(this.container()).width();\n\t\t\t\tlet elementHeight = $(this.container()).height();\n\t\t\t\tlet topLeftMargin = 0;\n\t\t\t\tlet pdfWidth = elementWidth! + (topLeftMargin * 2);\n\t\t\t\tlet pdfHeight = (pdfWidth * 1) + (topLeftMargin * 2);\n\t\t\t\tlet totalPDFPages = Math.ceil(elementHeight! / pdfHeight) - 1;\n\t\t\t\t//#endregion\n\n\t\t\t\tlet pdf = new jsPDF({\n\t\t\t\t\torientation: \"landscape\",\n\t\t\t\t\tunit: \"pt\",\n\t\t\t\t\tformat: [pdfWidth, pdfHeight]\n\t\t\t\t});\n\n\t\t\t\tvar imgData = canvas.toDataURL(\"image/png\", 1.0);\n\t\t\t\tpdf.addImage(imgData, \"png\", topLeftMargin, topLeftMargin, elementWidth, elementHeight);\n\n\t\t\t\tfor (let i = 1; i <= totalPDFPages; i++)\n\t\t\t\t{\n\t\t\t\t\tpdf.addPage([pdfWidth, pdfHeight], \"landscape\");\n\t\t\t\t\tpdf.addImage(imgData, \"png\", topLeftMargin, -(pdfHeight * i) + (topLeftMargin * 4), elementWidth, elementHeight);\n\t\t\t\t}\n\n\t\t\t\tif (autoPrint)\n\t\t\t\t\tpdf.autoPrint();\n\n\t\t\t\tpdf.save(fileName);\n\n\t\t\t\tif (loader)\n\t\t\t\t\thideLoader();\n\t\t\t});\n\t\t}, 100);\n\t}\n\n\tgetOptions()\n\t{\n\t\treturn this.options<SchedulerOptions>();\n\t}\n\t//#endregion\n\n\t//#endregion\n}\n//#endregion\n\n//#region Classes\nclass SchedulerEvent extends VrControlsEvent\n{\n\tsender: Scheduler;\n}\n\nclass SchedulerNavigateEvent extends SchedulerEvent\n{\n\taction?: SchedulerNavigateActionEnum;\n\tdate?: Date;\n\tview?: SchedulerViewEnum;\n\tpreviousDate: Date | null;\n}\n\nclass SchedulerViewChangeEvent extends SchedulerEvent\n{\n\tpreviousView: SchedulerViewEnum;\n\tview: SchedulerViewEnum;\n}\n\nclass SchedulerIntervalChangeEvent extends SchedulerEvent\n{\n\tvalue?: number;\n\tview?: SchedulerViewEnum;\n\tpreviousValue: number | undefined;\n}\n\nclass SchedulerResourcesChangeEvent extends SchedulerEvent\n{\n\tresources: SchedulerResource[];\n\tview?: SchedulerViewEnum;\n}\n\nenum SchedulerDateTypeEnum\n{\n\tStart = 0,\n\tEnd = 1\n}\n\n//#region Click events\nclass SchedulerClickEvent extends SchedulerEvent\n{\n\tstart: Date;\n\tend: Date;\n\tresourceId: string;\n\telement: HTMLElement;\n\tslotElement: SchedulerSlotElement;\n}\n\nexport class SchedulerTimeslotClickEvent extends SchedulerClickEvent\n{\n}\n\nexport class SchedulerAppointmentClickEvent extends SchedulerClickEvent\n{\n\tdataItem: SchedulerData;\n}\n\nexport class SchedulerAvailabilityClickEvent extends SchedulerClickEvent\n{\n\tdataItem: SchedulerData;\n}\n//#endregion\n\n//#region Move events\nclass SchedulerMoveEvent extends SchedulerEvent\n{\n\tstart: Date;\n\tend: Date;\n\tresourceId: string;\n\tdivElement: HTMLDivElement;\n\tdataItem: SchedulerData;\n}\n\nclass SchedulerMoveStartEvent extends SchedulerMoveEvent\n{\n}\n\nclass SchedulerMovingEvent extends SchedulerMoveEvent\n{\n\n}\n\nclass SchedulerMoveEndEvent extends SchedulerMoveEvent\n{\n}\n//#endregion\n\n//#region Resize events\nclass SchedulerResizeEvent extends SchedulerEvent\n{\n\tstart: Date;\n\tend: Date;\n\tresourceId: string;\n\tdivElement: HTMLDivElement;\n\tdataItem: SchedulerData;\n}\n\nclass SchedulerResizeStartEvent extends SchedulerResizeEvent\n{\n}\n\nclass SchedulerResizingEvent extends SchedulerResizeEvent\n{\n\n}\n\nclass SchedulerResizeEndEvent extends SchedulerResizeEvent\n{\n}\n//#endregion\n\nclass SchedulerMaxResourceNumber\n{\n\tdayView?: number;\n\tweekView?: number;\n\tfourWeeksView?: number;\n}\n\nclass InternalSchedulerAppointment\n{\n\tslotsOccupied?: SchedulerSlotElement[];\n\tpositioned?: boolean;\n\toverlappedList?: SchedulerData[];\n}\n\nclass SchedulerExpandCollapseEvent extends SchedulerEvent\n{\n\tbuttonExpand: Button;\n\tbuttonCollpase: Button;\n}\n\nclass SchedulerExpandEvent extends SchedulerExpandCollapseEvent\n{\n}\n\nclass SchedulerCollapseEvent extends SchedulerExpandCollapseEvent\n{\n}\n\nclass SchedulerEditable\n{\n\tmove?: boolean;\n\tresize?: boolean;\n\t//delete?: boolean;\n}\n//#endregion"],"names":["numberOfRows","sum","slotColumnIndex","duration","start","end","options","e"],"mappings":"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"}