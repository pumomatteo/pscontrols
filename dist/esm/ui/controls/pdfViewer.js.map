{"version":3,"file":"pdfViewer.js","sources":["../../../../src/ui/controls/pdfViewer.ts"],"sourcesContent":["import { ControlTypeEnum, createWindow, puma, IconClassicLight, IconClass, div, createButton, span, createTextBox, createLabel, TextModeEnum, PdfViewerToolbarAreaEnum, PdfViewerToolbarSettings, ToolbarItemOnClickEvent, PdfViewerToolbarItem, notify, notifyError, OnContentRenderedEvent } from \"../vr\";\nimport { VrControlOptions, VrControl, AttributeSettings } from \"../common\";\nimport { PDFDocumentProxy } from \"types/pdfjs\";\nimport { Window, WindowOpenEvent } from \"../controls/window\";\nimport { LoaderManager } from \"../../../src/managers/loaderManager\";\nimport { TextBox } from \"./textbox\";\nimport { Label } from \"./label\";\nimport { PrintManager } from \"../../../src/managers/printManager\";\nimport { UtilityManager } from \"../../../src/managers/utilityManager\";\nimport { DeviceManager } from \"../../../src/managers/deviceManager\";\n\ndeclare var pdfjsLib: any;\n\n//#region Options\nexport class PdfViewerOptions extends VrControlOptions\n{\n\tcontent?: string;\n\tbase64?: boolean;\n\tpopup?: boolean | PdfViewerWindowSettings;\n\tscale?: number;\n\ttextSelection?: boolean;\n\ttoolbar?: boolean | PdfViewerToolbarSettings;\n\tfileName?: string;\n\n\tonContentRendered?: (e: OnContentRenderedEvent) => void;\n}\n//#endregion\n\n//#region Control\nexport class PdfViewer extends VrControl\n{\n\tprivate _state: PdfState;\n\tprivate _window: Window;\n\tprivate _currentPage: number;\n\tprivate _pdfViewerCanvasContainer: HTMLElement;\n\tprivate _divToolbar: HTMLElement;\n\tprivate _txtCurrentPage: TextBox;\n\tprivate _lblPagesNumber: Label;\n\n\tconstructor(element: HTMLElement, options?: PdfViewerOptions | null)\n\t{\n\t\t//#region Options\n\t\tif (options == null)\n\t\t\toptions = new PdfViewerOptions();\n\n\t\tif (options.base64 == null) options.base64 = false;\n\t\tif (options.scale == null) (DeviceManager.isMobile()) ? options.scale = 0.5 : options.scale = 1.3;\n\t\tif (options.textSelection == null) options.textSelection = true;\n\t\tif (options.fileName == null) options.fileName = \"Documento\";\n\t\tif (options.tabIndex == null) options.tabIndex = -1;\n\n\t\tif (options.popup == null) options.popup = false;\n\t\tif (options.popup !== false) \n\t\t{\n\t\t\tif (options.popup === true)\n\t\t\t\toptions.popup = new PdfViewerWindowSettings();\n\n\t\t\tif (options.popup.maximize == null) options.popup.maximize = false;\n\t\t\tif (options.popup.title == null) options.popup.title = \"Documento\";\n\t\t}\n\n\t\tif (options.toolbar == null) options.toolbar = true;\n\t\tif (options.toolbar !== false)\n\t\t{\n\t\t\tif (options.toolbar === true)\n\t\t\t\toptions.toolbar = new PdfViewerToolbarSettings();\n\n\t\t\tif (options.toolbar.navigation == null) options.toolbar.navigation = true;\n\t\t\tif (options.toolbar.print == null) options.toolbar.print = true;\n\t\t\tif (options.toolbar.zoom == null) options.toolbar.zoom = true;\n\t\t\tif (options.toolbar.download == null) options.toolbar.download = true;\n\t\t\tif (options.toolbar.items == null) options.toolbar.items = [];\n\t\t}\n\t\t//#endregion\n\n\t\tsuper(element, options, ControlTypeEnum.PdfViewer);\n\t\tthis.container().style.cssText += \"display: flex;\";\n\t\tthis._state = new PdfState(1, options.scale);\n\n\t\t//#region Window\n\t\tif (options.popup !== false)\n\t\t{\n\t\t\tthis._window = createWindow({\n\t\t\t\taddToControlList: false,\n\t\t\t\ttitle: options.popup.title,\n\t\t\t\tfooter: false,\n\t\t\t\tcloseable: options.popup.closeable,\n\t\t\t\tclass: \"vrWindowPdfViewer\",\n\t\t\t\tclassContainer: this.element().id + \"_wndUtility\",\n\t\t\t\tonOpen: options.popup.onOpen\n\t\t\t});\n\t\t}\n\t\t//#endregion\n\n\t\tlet elementToAppend = (options.popup === false) ? this.element() : this._window.element();\n\t\tthis._divToolbar = div(elementToAppend, { class: \"vrPdfViewerDivToolbar\" });\n\t\tif (options.toolbar !== false)\n\t\t\tthis.createToolbar();\n\n\t\tthis._pdfViewerCanvasContainer = puma(\"<div class='vrPdfViewerCanvasContainer'></div>\").vrAppendToPuma(elementToAppend)[0];\n\t\tpuma(this._pdfViewerCanvasContainer).on(\"scroll\", (e: JQuery.ScrollEvent) =>\n\t\t{\n\t\t\t//#region Scroll\n\t\t\tlet canvasHeight = Number(puma(this.canvasContainer()).find(\"canvas\").attr(\"height\")) + 25;\n\t\t\tlet diff = Math.trunc(puma(this._pdfViewerCanvasContainer).scrollTop() / canvasHeight) + 1;\n\n\t\t\tif (this._txtCurrentPage != null)\n\t\t\t\tthis._txtCurrentPage.value(diff, false);\n\n\t\t\tthis._currentPage = diff;\n\t\t\t//#endregion\n\t\t});\n\n\t\tif (options.toolbar === false)\n\t\t{\n\t\t\tpuma(this._divToolbar).hide();\n\t\t\tpuma(this.canvasContainer()).css(\"height\", \"Calc(100% - 25px)\");\n\t\t}\n\t\telse\n\t\t\tpuma(this.canvasContainer()).css(\"height\", \"Calc(100% - 62px)\");\n\n\t\tthis.content(options.content);\n\t}\n\n\t//#region Toolbar\n\tprivate createToolbar()\n\t{\n\t\tlet options = this.getOptions();\n\t\toptions.toolbar = (options.toolbar as PdfViewerToolbarSettings);\n\n\t\t//#region Navigations info\n\t\tlet spanLeftArea = span(this.toolbar(), { class: \"vrPdfViewer_toolbarLeftArea\" });\n\t\tif (options.toolbar.navigation)\n\t\t{\n\t\t\tcreateButton({\n\t\t\t\ticon: IconClassicLight.Backward,\n\t\t\t\tcss: \"background: none; border: none;\",\n\t\t\t\tonClick: (e) => this._txtCurrentPage.value(1)\n\t\t\t}, spanLeftArea);\n\n\t\t\tcreateButton({\n\t\t\t\ticon: IconClassicLight.CaretLeft,\n\t\t\t\tcss: \"background: none; border: none; margin-right: 5px; font-size: 20px; margin-top: 1px;\",\n\t\t\t\tonClick: (e) => this._txtCurrentPage.value(this._currentPage - 1)\n\t\t\t}, spanLeftArea);\n\n\t\t\tthis._txtCurrentPage = createTextBox({\n\t\t\t\tmode: TextModeEnum.Numeric,\n\t\t\t\tvalue: 1,\n\t\t\t\twidth: 38,\n\t\t\t\tonChanged: (e) =>\n\t\t\t\t{\n\t\t\t\t\tlet currentPage = Number(e.value);\n\t\t\t\t\tif (Number(e.value) > this._state.pdf.numPages)\n\t\t\t\t\t\tcurrentPage = this._state.pdf.numPages\n\n\t\t\t\t\tif (Number(e.value) < 1)\n\t\t\t\t\t\tcurrentPage = 1;\n\n\t\t\t\t\tthis._currentPage = currentPage;\n\t\t\t\t\tthis._txtCurrentPage.value(currentPage, false);\n\t\t\t\t\tlet canvasHeight = Number(puma(this.canvasContainer()).find(\"canvas\").attr(\"height\"));\n\t\t\t\t\tpuma(this.canvasContainer()).scrollTop((canvasHeight + 54) * (currentPage - 1));\n\t\t\t\t}\n\t\t\t}, spanLeftArea);\n\t\t\tthis._currentPage = 1;\n\n\t\t\tthis._lblPagesNumber = createLabel({\n\t\t\t\ttext: \"/ 3\",\n\t\t\t\tcssContainer: \"margin-left: 5px; margin-right: 10px; min-width: 20px;\"\n\t\t\t}, spanLeftArea);\n\n\t\t\tcreateButton({\n\t\t\t\ticon: IconClassicLight.CaretRight,\n\t\t\t\tcss: \"background: none; border: none; font-size: 20px; margin-top: 1px;\",\n\t\t\t\tonClick: (e) => this._txtCurrentPage.value(this._currentPage + 1)\n\t\t\t}, spanLeftArea);\n\n\t\t\tcreateButton({\n\t\t\t\ticon: IconClassicLight.Forward,\n\t\t\t\tcss: \"background: none; border: none;\",\n\t\t\t\tonClick: (e) => this._txtCurrentPage.value(this._state.pdf.numPages)\n\t\t\t}, spanLeftArea);\n\t\t}\n\t\t//#endregion\n\n\t\t//#region Zoom\n\t\tlet spanCenterArea = span(this.toolbar(), { css: \"justify-content: center;\", class: \"vrPdfViewer_toolbarCenterArea\" });\n\t\tif (options.toolbar.zoom)\n\t\t{\n\t\t\tcreateButton({\n\t\t\t\ticon: IconClassicLight.MagnifyingGlassMinus,\n\t\t\t\tcss: \"border: none; background: none; font-size: 16px;\",\n\t\t\t\tcssContainer: \"margin-right: 5px;\",\n\t\t\t\ttooltip: \"Togli zoom\",\n\t\t\t\tonClick: (e) => \n\t\t\t\t{\n\t\t\t\t\tthis._state.scale -= 0.2;\n\t\t\t\t\tthis.content();\n\t\t\t\t}\n\t\t\t}, spanCenterArea);\n\n\t\t\tcreateButton({\n\t\t\t\ticon: IconClassicLight.MagnifyingGlassPlus,\n\t\t\t\tcss: \"border: none; background: none; font-size: 16px;\",\n\t\t\t\tcssContainer: \"margin-right: 5px;\",\n\t\t\t\ttooltip: \"Aumenta zoom\",\n\t\t\t\tonClick: (e) => \n\t\t\t\t{\n\t\t\t\t\tthis._state.scale += 0.2;\n\t\t\t\t\tthis.content();\n\t\t\t\t}\n\t\t\t}, spanCenterArea);\n\t\t}\n\t\t//#endregion\n\n\t\t//#region Buttons\n\t\tlet spanRightArea = span(this.toolbar(), { css: \"justify-content: flex-end;\", class: \"vrPdfViewer_toolbarRightArea\" });\n\t\tif (options.toolbar.download)\n\t\t{\n\t\t\tcreateButton({\n\t\t\t\ticon: IconClassicLight.Download,\n\t\t\t\tcss: \"border: none; background: none; font-size: 16px;\",\n\t\t\t\tcssContainer: \"margin-right: 5px;\",\n\t\t\t\ttooltip: \"Scarica\",\n\t\t\t\tonClick: (e) => this.download()\n\t\t\t}, spanRightArea);\n\t\t}\n\n\t\tif (options.toolbar.print)\n\t\t{\n\t\t\tcreateButton({\n\t\t\t\ticon: IconClassicLight.Print,\n\t\t\t\tcss: \"border: none; background: none; font-size: 16px;\",\n\t\t\t\ttooltip: \"Stampa\",\n\t\t\t\tonClick: (e) => this.print()\n\t\t\t}, spanRightArea);\n\t\t}\n\t\t//#endregion\n\n\t\tthis.addToolbarItems(options.toolbar.items!);\n\t}\n\n\taddToolbarItems(toolbarItems: PdfViewerToolbarItem[])\n\t{\n\t\tfor (let toolbarItem of toolbarItems)\n\t\t{\n\t\t\tlet area = this.toolbarRightArea();\n\t\t\tswitch (toolbarItem.area)\n\t\t\t{\n\t\t\t\tcase PdfViewerToolbarAreaEnum.Left: area = this.toolbarLeftArea(); break;\n\t\t\t\tcase PdfViewerToolbarAreaEnum.Center: area = this.toolbarCenterArea(); break;\n\t\t\t\tcase PdfViewerToolbarAreaEnum.Right: area = this.toolbarRightArea(); break;\n\t\t\t}\n\n\t\t\tlet css = (toolbarItem.css != null) ? toolbarItem.css : \"\";\n\t\t\tlet attributes: AttributeSettings[] | undefined = (toolbarItem.value != null) ? [{ name: \"value\", value: toolbarItem.value }] : undefined;\n\t\t\tcreateButton({\n\t\t\t\ticon: toolbarItem.icon,\n\t\t\t\ttext: toolbarItem.text,\n\t\t\t\tattributes: attributes,\n\t\t\t\tcss: \"background: none; border: none;\" + css,\n\t\t\t\tcssContainer: toolbarItem.cssContainer,\n\t\t\t\tonClick: (e) => \n\t\t\t\t{\n\t\t\t\t\tif (toolbarItem.onClick != null)\n\t\t\t\t\t{\n\t\t\t\t\t\tlet clickEvent = new ToolbarItemOnClickEvent();\n\t\t\t\t\t\tclickEvent.sender = this;\n\t\t\t\t\t\tclickEvent.text = toolbarItem.text;\n\t\t\t\t\t\tclickEvent.value = toolbarItem.value;\n\t\t\t\t\t\ttoolbarItem.onClick(clickEvent);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}, area);\n\t\t}\n\t}\n\n\ttoolbar()\n\t{\n\t\treturn this._divToolbar;\n\t}\n\n\ttoolbarLeftArea()\n\t{\n\t\treturn this.toolbarArea(PdfViewerToolbarAreaEnum.Left);\n\t}\n\n\ttoolbarCenterArea()\n\t{\n\t\treturn this.toolbarArea(PdfViewerToolbarAreaEnum.Center);\n\t}\n\n\ttoolbarRightArea()\n\t{\n\t\treturn this.toolbarArea(PdfViewerToolbarAreaEnum.Right);\n\t}\n\n\ttoolbarArea(area: PdfViewerToolbarAreaEnum)\n\t{\n\t\tlet options = this.getOptions();\n\t\tlet elementWhereSearch = (options.popup === false) ? this.container() : this._window.container();\n\n\t\tlet areaClass = \"\";\n\t\tswitch (area)\n\t\t{\n\t\t\tcase PdfViewerToolbarAreaEnum.Left: areaClass = \"vrPdfViewer_toolbarLeftArea\"; break;\n\t\t\tcase PdfViewerToolbarAreaEnum.Center: areaClass = \"vrPdfViewer_toolbarCenterArea\"; break;\n\t\t\tcase PdfViewerToolbarAreaEnum.Right: areaClass = \"vrPdfViewer_toolbarRightArea\"; break;\n\t\t}\n\t\treturn puma(elementWhereSearch).find(\".\" + areaClass)[0];\n\t}\n\t//#endregion\n\n\tcontent(content?: string)\n\t{\n\t\tlet promise = new Promise((callback?: Function) =>\n\t\t{\n\t\t\tpuma(this.canvasContainer()).empty();\n\t\t\tlet options = this.getOptions();\n\n\t\t\tif (content != null)\n\t\t\t{\n\t\t\t\tLoaderManager.show(this.element());\n\t\t\t\toptions.content = content;\n\n\t\t\t\t//#region Load document\n\t\t\t\tconst loadingTask = pdfjsLib.getDocument((!options.base64) ? content : { data: atob(content) });\n\t\t\t\tloadingTask.promise.then((pdf: PDFDocumentProxy) =>\n\t\t\t\t{\n\t\t\t\t\tthis._state.pdf = pdf;\n\t\t\t\t\tlet pagesNumber = this._state.pdf.numPages;\n\t\t\t\t\tif (this._lblPagesNumber != null)\n\t\t\t\t\t\tthis._lblPagesNumber.value(\"/ \" + pagesNumber);\n\n\t\t\t\t\tthis.internalRenderRecursive(1);\n\t\t\t\t\tLoaderManager.hide();\n\n\t\t\t\t\tlet options = this.getOptions();\n\t\t\t\t\tif (options.onContentRendered != null)\n\t\t\t\t\t{\n\t\t\t\t\t\tlet event = new OnContentRenderedEvent();\n\t\t\t\t\t\tevent.sender = this;\n\t\t\t\t\t\tevent.pdf = this._state.pdf;\n\t\t\t\t\t\toptions.onContentRendered(event);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (callback != null)\n\t\t\t\t\t\tcallback();\n\t\t\t\t},\n\t\t\t\t\t(error: any) => \n\t\t\t\t\t{\n\t\t\t\t\t\tnotifyError(error);\n\t\t\t\t\t});\n\t\t\t\t//#endregion\n\t\t\t}\n\t\t\telse if (options.content != null)\n\t\t\t{\n\t\t\t\tlet pagesNumber = this._state.pdf.numPages;\n\t\t\t\tif (this._lblPagesNumber != null)\n\t\t\t\t\tthis._lblPagesNumber.value(\"/ \" + pagesNumber);\n\n\t\t\t\tthis.internalRenderRecursive(1);\n\t\t\t}\n\t\t});\n\t\treturn promise;\n\t}\n\n\tprivate internalRenderRecursive(pageIndex: number)\n\t{\n\t\tif (pageIndex > this._state.pdf.numPages || this._state.pdf == null)\n\t\t\treturn;\n\n\t\tlet options = this.getOptions();\n\t\tthis._state.pdf.getPage(pageIndex).then((page) => \n\t\t{\n\t\t\t//#region Structure\n\t\t\tlet divCanvasTextContainer = div(this.canvasContainer(), { class: \"vrPdfViewer_divCanvasTextContainer\" });\n\t\t\tlet canvas = puma(\"<canvas style='border-top: solid 50px #e8e8e8;'></canvas>\").vrAppendToPuma(divCanvasTextContainer)[0] as HTMLCanvasElement;\n\t\t\tlet ctx = canvas.getContext('2d');\n\n\t\t\tlet divTextLayer: HTMLElement | null = null;\n\t\t\tif (options.textSelection)\n\t\t\t{\n\t\t\t\tdivTextLayer = puma(\"<div class='vrPdfViewer_divTextLayer'></div>\").vrAppendToPuma(divCanvasTextContainer)[0];\n\t\t\t\tdivTextLayer!.style.cssText += \"--scale-factor: \" + this._state.scale;\n\t\t\t}\n\t\t\t//#endregion\n\n\t\t\tlet viewport = page.getViewport({ scale: this._state.scale });\n\t\t\tcanvas.width = viewport.width;\n\t\t\tcanvas.height = viewport.height;\n\n\t\t\tif (DeviceManager.isMobile())\n\t\t\t{\n\t\t\t\tcanvas.width = (viewport.width > window.innerWidth) ? window.innerWidth : viewport.width;\n\t\t\t\tcanvas.height = (viewport.height > window.innerHeight) ? window.innerHeight : viewport.height;\n\t\t\t}\n\n\t\t\t//#region Popup\n\t\t\tif (options.popup !== false)\n\t\t\t{\n\t\t\t\toptions.popup = (options.popup! as PdfViewerWindowSettings);\n\t\t\t\tif (options.popup.maximize)\n\t\t\t\t\tthis._window.maximize();\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tlet width = 957;\n\t\t\t\t\tif (options.popup.width != null)\n\t\t\t\t\t\twidth = options.popup.width;\n\n\t\t\t\t\tlet height = document.body.clientHeight - 60;\n\t\t\t\t\tif (options.popup.height != null)\n\t\t\t\t\t\theight = options.popup.height;\n\n\t\t\t\t\tthis._window.width(width);\n\t\t\t\t\tthis._window.element().style.cssText += \"height: \" + height + \"px;\";\n\t\t\t\t\tthis._window.container().style.cssText += \"height: \" + (height + 30) + \"px;\";\n\t\t\t\t\tthis._window.center();\n\t\t\t\t}\n\t\t\t}\n\t\t\t//#endregion\n\n\t\t\tpage.render({\n\t\t\t\tcanvasContext: ctx!,\n\t\t\t\tviewport: viewport\n\t\t\t});\n\n\t\t\t//#region Text selection\n\t\t\tif (options.textSelection)\n\t\t\t{\n\t\t\t\tpage.getTextContent().then((textContent) =>\n\t\t\t\t{\n\t\t\t\t\tpdfjsLib.renderTextLayer({\n\t\t\t\t\t\ttextContent: textContent,\n\t\t\t\t\t\tcontainer: divTextLayer,\n\t\t\t\t\t\tviewport: viewport\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t\t//#endregion\n\n\t\t\tpageIndex++;\n\t\t\tthis.internalRenderRecursive(pageIndex);\n\t\t}, (error: any) => notifyError(error));\n\t}\n\n\tpage(page?: number)\n\t{\n\t\tif (page != null)\n\t\t\tthis._txtCurrentPage.value(page);\n\n\t\treturn this._currentPage;\n\t}\n\n\tfileName(name?: string)\n\t{\n\t\tif (name != null)\n\t\t\tthis.getOptions().fileName = name;\n\n\t\treturn this.getOptions().fileName;\n\t}\n\n\tdownload()\n\t{\n\t\tlet options = this.getOptions();\n\t\tthis.getData().then((base64bytes) => UtilityManager.downloadPdfBytes(base64bytes, options.fileName))\n\t}\n\n\tprint()\n\t{\n\t\tthis.getData().then((base64bytes) => PrintManager.printBytes(base64bytes))\n\t}\n\n\tasync getData(): Promise<string>\n\t{\n\t\tif (this._state.pdf != null)\n\t\t{\n\t\t\tlet data = await this._state.pdf.getData();\n\t\t\tlet base64string = UtilityManager.bytesToBase64(data);\n\t\t\treturn base64string;\n\t\t}\n\t\treturn \"\";\n\t}\n\n\t//#region Window\n\topen(content?: string)\n\t{\n\t\tlet promise = new Promise((callback?: Function) =>\n\t\t{\n\t\t\tlet options = this.getOptions();\n\t\t\tif (options.popup === false)\n\t\t\t\treturn;\n\n\t\t\tif (content != null)\n\t\t\t{\n\t\t\t\tthis.content(content).then(() =>\n\t\t\t\t{\n\t\t\t\t\tif (callback != null)\n\t\t\t\t\t\tcallback()\n\t\t\t\t});\n\t\t\t}\n\t\t\tthis._window.open();\n\t\t});\n\t\treturn promise;\n\t}\n\n\tclose()\n\t{\n\t\tthis._window.close();\n\t}\n\n\twindow()\n\t{\n\t\treturn this._window;\n\t}\n\n\twindowTitle(title: string)\n\t{\n\t\tthis._window.title(title);\n\t}\n\n\twindowCloseCallback(callback: Function)\n\t{\n\t\tif (this.window() != null)\n\t\t{\n\t\t\tthis.window().close\n\t\t}\n\t}\n\t//#endregion\n\n\tgetOptions()\n\t{\n\t\treturn this.options<PdfViewerOptions>();\n\t}\n\n\tprivate canvasContainer(): HTMLElement\n\t{\n\t\treturn this._pdfViewerCanvasContainer;\n\t}\n}\n//#endregion\n\n//#region Classes\nclass PdfState\n{\n\tpdf: PDFDocumentProxy;\n\tcurrentPage: number;\n\tscale: number;\n\n\tconstructor(currentPage: number, scale: number)\n\t{\n\t\tthis.currentPage = currentPage;\n\t\tthis.scale = scale;\n\t}\n}\n\nclass PdfViewerWindowSettings\n{\n\tmaximize?: boolean;\n\twidth?: number;\n\theight?: number;\n\ttitle?: string;\n\tcloseable?: boolean;\n\tonOpen?(e: WindowOpenEvent): void;\n}\n\nclass OnWindowOpenEvent\n{\n\tsender: PdfViewer;\n}\n//#endregion"],"names":["options"],"mappings":"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"}